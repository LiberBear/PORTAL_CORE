BX.namespace("BX.Tasks.Component");BX.Tasks.Component.TaskView=function(t){this.parameters=t||{};this.taskId=this.parameters.taskId;this.layout={favorite:BX("task-detail-favorite"),switcher:BX("task-switcher"),switcherTabs:[],elapsedHours:BX("task-switcher-elapsed-hours"),elapsedMinutes:BX("task-switcher-elapsed-minutes"),createButton:BX("task-detail-create-button")};this.messages=this.parameters.messages||{};for(var e in this.messages){BX.message[e]=this.messages[e]}this.paths=this.parameters.paths||{};this.createButtonMenu=[];this.query=new BX.Tasks.Util.Query;this.query.bindEvent("executed",BX.proxy(this.onQueryExecuted,this));this.initFavorite();this.initProject();this.initCreateButton();this.initSwitcher();this.initViewer();this.initAjaxErrorHandler();this.fireTaskEvent();this.temporalCommentFix()};BX.Tasks.Component.TaskView.prototype.temporalCommentFix=function(){BX.addCustomEvent(window,"OnUCFormResponse",function(t,e,s){if(BX.type.isNotEmptyString(t)&&t.indexOf("TASK_")===0&&BX.proxy_context&&BX.proxy_context.jsonFailure===true){if(s&&s["handler"]&&s.handler["oEditor"]&&s.handler.oEditor["DenyBeforeUnloadHandler"]){s.handler.oEditor.DenyBeforeUnloadHandler()}BX.reload()}})};BX.Tasks.Component.TaskView.prototype.fireTaskEvent=function(){if(this.parameters.eventTaskUgly!=null){BX.Tasks.Util.fireGlobalTaskEvent(this.parameters.componentData.EVENT_TYPE,{ID:this.parameters.eventTaskUgly.id},{STAY_AT_PAGE:true},this.parameters.eventTaskUgly)}};BX.Tasks.Component.TaskView.prototype.initCreateButton=function(){BX.bind(this.layout.createButton,"click",BX.proxy(this.onCreateButtonClick,this));this.createButtonMenu=[{text:this.messages.addTask,className:"menu-popup-item-create",href:this.paths.newTask},{text:this.messages.addSubTask,className:"menu-popup-item-create",href:this.paths.newSubTask}]};BX.Tasks.Component.TaskView.prototype.onCreateButtonClick=function(){BX.PopupMenu.show("task-detail-create-button",this.layout.createButton,this.createButtonMenu,{})};BX.Tasks.Component.TaskView.prototype.initFavorite=function(){BX.bind(this.layout.favorite,"click",BX.proxy(this.onFavoriteClick,this))};BX.Tasks.Component.TaskView.prototype.onFavoriteClick=function(){var t=BX.hasClass(this.layout.favorite,"task-detail-favorite-active")?"task.favorite.delete":"task.favorite.add";this.query.deleteAll();this.query.add(t,{taskId:this.taskId},{code:t});this.query.execute();BX.toggleClass(this.layout.favorite,"task-detail-favorite-active")};BX.Tasks.Component.TaskView.prototype.initProject=function(){var t=BX("task-detail-group");if(!t){return}var e=new BX.Tasks.GroupItemSet({scope:t,useSearch:true,min:0,max:1});e.load([this.parameters.project]);e.bindEvent("change",BX.proxy(this.onProjectChanged,this))};BX.Tasks.Component.TaskView.prototype.initSwitcher=function(){if(!this.layout.switcher){return}var t=this.layout.switcher.getElementsByClassName("task-switcher");var e=this.layout.switcher.parentNode.getElementsByClassName("task-switcher-block");for(var s=0;s<t.length;s++){var a=t[s];var i=e[s];BX.bind(a,"click",BX.proxy(this.onSwitch,this));this.layout.switcherTabs.push({title:a,block:i})}BX.addCustomEvent("TaskElapsedTimeUpdated",BX.proxy(function(t,e){this.layout.elapsedHours.innerText=t;this.layout.elapsedMinutes.innerText=e},this))};BX.Tasks.Component.TaskView.prototype.onSwitch=function(){var t=BX.proxy_context;if(BX.hasClass(t,"task-switcher-selected")){return false}for(var e=0;e<this.layout.switcherTabs.length;e++){var s=this.layout.switcherTabs[e].title;var a=this.layout.switcherTabs[e].block;if(s===t){BX.addClass(s,"task-switcher-selected");BX.addClass(a,"task-switcher-block-selected")}else{BX.removeClass(s,"task-switcher-selected");BX.removeClass(a,"task-switcher-block-selected")}}return false};BX.Tasks.Component.TaskView.prototype.onQueryExecuted=function(t){};BX.Tasks.Component.TaskView.prototype.onProjectChanged=function(t){var e=BX.type.isArray(t)&&t.length?t[0]:0;this.query.deleteAll();this.query.add("task.update",{id:this.taskId,data:{GROUP_ID:e},parameters:{}},{code:"task.update.project"});this.query.execute()};BX.Tasks.Component.TaskView.prototype.initViewer=function(){var t=["task-detail-description","task-detail-files","task-comments-block","task-files-block"];for(var e=0;e<t.length;e++){var s=BX(t[e]);if(s){top.BX.viewElementBind(s,{},function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))})}}};BX.Tasks.Component.TaskView.prototype.initAjaxErrorHandler=function(){BX.addCustomEvent("TaskAjaxError",function(t){BX.Tasks.alert(t)})};
//# sourceMappingURL=logic.map.js
if(typeof BX.CrmWidget==="undefined"){BX.CrmWidget=function(){this._id="";this._settings=null;this._entityTypeName="";this._typeName="";this._serviceUrl="";this._title="";this._prefix="";this._heightInPixel=0;this._widthInPercent=0;this._layout="";this._config=null;this._configEditor=null;this._data={};this._container=null;this._wrapper=null;this._headerWrapper=null;this._contentWrapper=null;this._settingButton=null;this._hasLayout=false;this._cell=null;this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this)};BX.CrmWidget.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._cell=this.getSetting("cell",null);this._config=this.getSetting("config","");this._typeName=BX.type.isNotEmptyString(this._config["typeName"])?this._config["typeName"]:"";if(this._typeName===""){throw"CrmWidget: The type name is not found."}this._data=this.getSetting("data",{});if(!BX.type.isArray(this._data["items"])){this._data["items"]=[]}this._prefix=this.getSetting("prefix","");var i=this.getSetting("containerId","");this._container=BX(i!==""?i:this._prefix+"_"+"container");this._heightInPixel=parseInt(this.getSetting("heightInPixel",0));if(this._heightInPixel<=0){this._heightInPixel=BX.CrmWidgetLayoutHeight.full}this._widthInPercent=parseInt(this.getSetting("widthInPercent",0));if(this._widthInPercent<=0){this._widthInPercent=100}this._layout=BX.type.isNotEmptyString(this._config["layout"])?this._config["layout"]:"";this.doInitialize()},doInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getEntityTypeName:function(){return this._entityTypeName},getTitle:function(){return BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:""},getMessage:function(t){var e=BX.CrmWidget.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},setContainer:function(t){this._container=t},getWrapper:function(){return this._wrapper},getPanel:function(){return this._cell?this._cell.getPanel():null},getCell:function(){return this._cell},getRow:function(){return this._cell?this._cell.getRow():null},getIndex:function(){return this._cell?this._cell.getWidgetIndex(this):-1},getNextSibling:function(){return this._cell?this._cell.getNextWidget(this):null},getConfig:function(){return this._config},getPeriodDescription:function(){var t=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:null;if(!t){return""}var e=BX.CrmWidgetConfigPeriodEditor.create("",{config:t});return!e.isEmpty()?e.getDescription():""},getHeight:function(){return BX.CrmWidgetLayoutHeight.undifined},getData:function(){return this._data},setData:function(t){this._data=t},refresh:function(){this.clearLayout();this.layout();var t=this.getPanel();if(t){t.processWidgetRefresh(this)}},invalidate:function(){},prepareHeader:function(t,e){var i=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(e&&typeof e["settings"]!=="undefined"){i.appendChild(e["settings"])}var n=BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:t},text:t})]})]});i.appendChild(n);if(e&&typeof e["edit"]!=="undefined"){n.appendChild(e["edit"])}return i},prepareButtons:function(){return{settings:BX.create("SPAN",{attrs:{className:"crm-widget-settings"}})}},renderHeader:function(t){this._headerWrapper=BX.create("DIV",{attrs:{className:"crm-widget-head"}});if(BX.type.isElementNode(t)){t.appendChild(this._headerWrapper)}else{this._wrapper.appendChild(this._headerWrapper)}this._settingButton=BX.create("SPAN",{attrs:{className:"crm-widget-settings"}});this._headerWrapper.appendChild(this._settingButton);var e=this.getTitle();if(e===""){e=this.getMessage("untitled")}this._headerWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-title-container"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-title",title:e},text:e}),this._editButton]})]}))},renderContent:function(){},renderLayout:function(){this.renderHeader();this.renderContent()},layout:function(){if(this._hasLayout){return}if(!this._container){throw"CrmWidget: Could not find container."}this._wrapper=BX.create("DIV",{attrs:{className:"crm-widget"}});this._wrapper.setAttribute("data-widget-id",this._id);var t=this.getNextSibling();var e=t!==null?t.getWrapper():null;if(e===null){this._container.appendChild(this._wrapper)}else{this._container.insertBefore(this._wrapper,e)}this.renderLayout();if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}this.innerClearLayout();if(this._settingButton){BX.unbind(this._settingButton,"click",this._settingButtonClickHandler);this._settingButton=null}if(this._container){try{this._container.removeChild(this._wrapper)}catch(t){}}this._wrapper=null;this._hasLayout=false},innerClearLayout:function(){},remove:function(){if(!window.confirm(this.getMessage("removalConfirmation").replace(/#TITLE#/gi,this.getTitle()))){return false}this.clearLayout();this.undock();return true},dock:function(t,e){t.addWidget(this,e);this._cell=t},undock:function(){if(this._cell){this._cell.removeWidget(this);this._cell=null}},processConfigSave:function(){var t=this.getPanel();if(!t||!this._configEditor){return}this._configEditor.saveConfig();this._config=this._configEditor.getConfig();t.saveConfig(BX.delegate(this.onAfterConfigSave,this))},onAfterConfigSave:function(){BX.CrmWidgetManager.getCurrent().prepareWidgetData(this)},ensureConfigEditorCreated:function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,entityTypeName:this._entityTypeName})}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,[{id:"configure",text:this.getMessage("menuItemConfigure"),onclick:this._settingMenuHandler},{id:"remove",text:this.getMessage("menuItemRemove"),onclick:this._settingMenuHandler}],{autoHide:true,offsetLeft:-21,offsetTop:-11,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){if(e.id==="configure"){this.openConfigDialog()}else if(e.id==="remove"){var i=this.getPanel();if(i){i.processWidgetRemoval(this)}}this.closeSettingMenu()},openConfigDialog:function(){this.ensureConfigEditorCreated();this._configEditor.openDialog()}};if(typeof BX.CrmWidget.messages==="undefined"){BX.CrmWidget.messages={}}BX.CrmWidget.create=function(t,e){var i=new BX.CrmWidget;i.initialize(t,e);return i}}if(typeof BX.CrmFunnelWidget==="undefined"){BX.CrmFunnelWidget=function(){this._chart=null;BX.CrmFunnelWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmFunnelWidget,BX.CrmWidget);BX.CrmFunnelWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-40+"px"}var i=BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"";var n=BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"";var r=BX.type.isArray(this._data["items"])?this._data["items"]:[];for(var s=0;s<r.length;s++){var o=BX.type.isNotEmptyString(r[s][n])?r[s][n]:"";if(o!==""){r[s][n]=BX.util.strip_tags(o)}}this._chart=AmCharts.makeChart(e.id,{type:"funnel",theme:"none",titleField:n,valueField:i,dataProvider:r,labelPosition:"right",depth3D:160,angle:16,outlineAlpha:2,outlineColor:"#FFFFFF",outlineThickness:2,startY:-400,marginRight:240,marginLeft:10,balloon:{fixedPosition:true}})};BX.CrmFunnelWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmFunnelWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,enableTitle:true,entityTypeName:this._entityTypeName})}};BX.CrmFunnelWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmFunnelWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmFunnelWidget.create=function(t,e){var i=new BX.CrmFunnelWidget;i.initialize(t,e);return i}}if(typeof BX.CrmPieWidget==="undefined"){BX.CrmPieWidget=function(){this._chart=null;BX.CrmPieWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmPieWidget,BX.CrmWidget);BX.CrmPieWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(e);if(this._heightInPixel>0){e.style.height=this._heightInPixel-40+"px"}this._chart=AmCharts.makeChart(e.id,{type:"pie",theme:"none",titleField:BX.type.isNotEmptyString(this._data["titleField"])?this._data["titleField"]:"",valueField:BX.type.isNotEmptyString(this._data["valueField"])?this._data["valueField"]:"",dataProvider:BX.type.isArray(this._data["items"])?this._data["items"]:[],labelsEnabled:false,depth3D:15,angle:30,outlineAlpha:.4,outlineColor:"#FFFFFF",outlineThickness:1,legend:{markerType:"circle",position:"right",marginRight:10,autoMargins:false}})};BX.CrmPieWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmPieWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,enableTitle:true,entityTypeName:this._entityTypeName})}};BX.CrmPieWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmPieWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmPieWidget.create=function(t,e){var i=new BX.CrmPieWidget;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidget==="undefined"){BX.CrmGraphWidget=function(){this._chart=null;this._chartWrapper=null;this._maxGraphCount=0;BX.CrmGraphWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmGraphWidget,BX.CrmWidget);BX.CrmGraphWidget.prototype.doInitialize=function(){var t=this.getPanel();if(t){this._maxGraphCount=t.getMaxGraphCount()}};BX.CrmGraphWidget.prototype.prepareGraphSettings=function(t){var e={title:t["title"],valueField:t["selectField"],balloonText:"[[title]]: [[value]]"};var i=typeof t["display"]!=="undefined"?t["display"]:{};var n=typeof i["graph"]!=="undefined"?i["graph"]:{};var r=this._typeName;if(BX.type.isNotEmptyString(n["type"])){r=t["display"]["type"]}if(BX.type.isNotEmptyString(n["clustered"])){e["clustered"]=n["clustered"]==="Y"}var s=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(s){e["lineColor"]=s["color"]}if(r==="bar"){e["type"]="column";e["fillAlphas"]=1}else{e["type"]="smoothedLine";e["lineThickness"]=2;e["bullet"]="round";e["bulletSize"]=7;e["bulletBorderAlpha"]=1}return e};BX.CrmGraphWidget.prototype.renderContent=function(){if(!AmCharts.isReady){if(BX.CrmWidgetPanel.isAjaxMode){AmCharts.handleLoad()}else{AmCharts.ready(BX.delegate(this.renderContent,this));return}}this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);if(this._heightInPixel>0){this._contentWrapper.style.height=this._heightInPixel+"px";this._contentWrapper.style.overflow="visible"}var t=this.getPeriodDescription();if(t!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+t})]}))}var e=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var i=[];var n=BX.type.isArray(e["graphs"])?e["graphs"]:null;if(n){var r=this._maxGraphCount>0&&n.length<this._maxGraphCount?n.length:this._maxGraphCount;for(var s=0;s<r;s++){i.push(this.prepareGraphSettings(n[s]))}}else{i.push(this.prepareGraphSettings(e))}var o=BX.type.isArray(e["values"])?e["values"]:[];var a=BX.type.isNotEmptyString(e["groupField"])?e["groupField"]:"";var h={type:"serial",theme:"none",marginLeft:20,dataProvider:o,graphs:i,dataDateFormat:this._data["dateFormat"],categoryField:a,legend:{useGraphSettings:true,equalWidths:false,position:"bottom"},chartCursor:{enabled:true,oneBalloonOnly:true,categoryBalloonEnabled:true,categoryBalloonColor:"#000000"}};var l=BX.type.isPlainObject(this._config["format"])?this._config["format"]:{};if(BX.type.isNotEmptyString(l["isCurrency"])&&l["isCurrency"]==="Y"){var d=this.getPanel().getCurrencyFormat();if(BX.type.isPlainObject(d)){h["numberFormatter"]={decimalSeparator:d["DEC_POINT"],thousandsSeparator:d["THOUSANDS_SEP"]}}}if(this._typeName==="bar"&&i.length>0){var g={id:"v1",axisAlpha:.3,gridAlpha:0};if(BX.type.isNotEmptyString(this._config["enableStack"])&&this._config["enableStack"]==="Y"){g["stackType"]="regular"}if(BX.type.isNotEmptyString(this._config["integersOnly"])&&this._config["integersOnly"]==="Y"){g["integersOnly"]=true}h["valueAxes"]=[g]}if(a==="DATE"){var c=[];var p=[];for(var u=1;u<=12;u++){c.push(BX.message["MONTH_"+u.toString()]);p.push(BX.message["MON_"+u.toString()])}AmCharts.monthNames=c;AmCharts.shortMonthNames=p;var f=BX.message("FORMAT_DATE");var _=f.indexOf("D")<f.indexOf("M")?"DD MMM":"MMM DD";h["chartCursor"]["categoryBalloonDateFormat"]=_;h["categoryAxis"]={parseDates:true,minPeriod:"DD",dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:_},{period:"WW",format:_},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]}}else if(a==="USER"){h["categoryAxis"]={labelRotation:o.length<5?0:45}}this._chartWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_chart_wrapper"}});this._contentWrapper.appendChild(this._chartWrapper);if(this._heightInPixel>0){this._chartWrapper.style.height=this._heightInPixel-40+"px"}this._chart=AmCharts.makeChart(this._chartWrapper.id,h)};BX.CrmGraphWidget.prototype.innerClearLayout=function(){if(this._chart){this._chart.clear();this._chart=null}};BX.CrmGraphWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmGraphWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,enableTitle:true,maxGraphCount:this.getMaxGraphCount(),entityTypeName:this.getEntityTypeName()})}};BX.CrmGraphWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.full};BX.CrmGraphWidget.prototype.invalidate=function(){if(this._chart){this._chart.invalidateSize()}};BX.CrmGraphWidget.prototype.getMaxGraphCount=function(){return this._maxGraphCount};BX.CrmGraphWidget.create=function(t,e){var i=new BX.CrmGraphWidget;i.initialize(t,e);return i}}if(typeof BX.CrmRatingWidget==="undefined"){BX.CrmRatingWidget=function(){BX.CrmRatingWidget.superclass.constructor.apply(this)};BX.extend(BX.CrmRatingWidget,BX.CrmWidget);BX.CrmRatingWidget.prototype.renderContent=function(){BX.addClass(this._wrapper,"crm-widget-rating");this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);var t=BX.create("DIV",{attrs:{className:"crm-widget-content-rating"}});this._contentWrapper.appendChild(t);var e=this.getPeriodDescription();if(e!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+e})]}))}var i=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:{};var n=parseInt(i["nomineeId"]);var r=BX.type.isArray(i["positions"])?i["positions"]:[];var s;var o=-1;for(s=0;s<r.length;s++){if(parseInt(r[s]["id"])===n){o=s;break}}var a;if(o>=0){var h=r[o];a=BX.type.isNotEmptyString(h["legendType"])&&h["legendType"]==="html"?h["legend"]:BX.util.htmlspecialchars(h["legend"]);t.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[BX.create("DIV",{attrs:{className:"crm-widget-rating-position-inner"},children:[BX.create("SPAN",{attrs:{className:"crm-widget-rating-pl"},text:this.getMessage("nomineeRatingPosition").replace("#POSITION#",h["value"])}),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]})]}))}var l=BX.create("DIV",{attrs:{className:"crm-widget-rating-positions"}});t.appendChild(l);for(s=0;s<r.length;s++){var d=r[s];var g=parseInt(d["id"]);if(g===n){continue}a=BX.type.isNotEmptyString(d["legendType"])&&d["legendType"]==="html"?d["legend"]:BX.util.htmlspecialchars(d["legend"]);l.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-rating-position"},children:[this.getMessage("ratingPosition").replace("#POSITION#",d["value"]),BX.create("SPAN",{attrs:{className:"crm-widget-rating-result"},children:[BX.create("SPAN",{html:BX.util.htmlspecialchars(this.getMessage("legend")).replace("#LEGEND#",a)})]})]}))}};BX.CrmRatingWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmRatingWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmRatingWidget.prototype.getHeight=function(){return BX.CrmWidgetLayoutHeight.half};BX.CrmRatingWidget.create=function(t,e){var i=new BX.CrmRatingWidget;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidget==="undefined"){BX.CrmNumericWidget=function(){BX.CrmNumericWidget.superclass.constructor.apply(this);this._widowResizeHandler=null};BX.extend(BX.CrmNumericWidget,BX.CrmWidget);BX.CrmNumericWidget.prototype.doInitialize=function(){};BX.CrmNumericWidget.prototype.getTitle=function(){var t=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";if(BX.type.isArray(this._data["items"])&&this._data["items"].length>0&&BX.type.isNotEmptyString(this._data["items"][0]["title"])){t=this._data["items"][0]["title"]}return t};BX.CrmNumericWidget.prototype.renderLayout=function(){var t,e,i,n,r;var s=this.prepareButtons();this._settingButton=s["settings"];var o=this.getPeriodDescription();if(this._layout==="tiled"){BX.addClass(this._wrapper,"crm-widget-total");var a,h,l;if(BX.type.isArray(this._data["items"])){if(this._data["items"].length>0){a=this._data["items"][0]}if(this._data["items"].length>1){h=this._data["items"][1]}if(this._data["items"].length>2){l=this._data["items"][2]}}if(!a){return}i=typeof a["display"]!=="undefined"?a["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");var d=BX.create("DIV",{attrs:{className:"crm-widget-total-top"}});if(n){d.style.backgroundColor=n["color"]}this._wrapper.appendChild(d);this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(a["title"])?a["title"]:this.getMessage("untitled"),s);d.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}t=this.prepareItemHtml(a);e=BX.type.isNotEmptyString(a["url"])?a["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]}));d.appendChild(this._contentWrapper);var g=BX.create("DIV",{attrs:{className:"crm-widget-total-bottom"}});this._wrapper.appendChild(g);var c=BX.create("DIV",{attrs:{className:"crm-widget-total-left"}});g.appendChild(c);if(h){i=typeof h["display"]!=="undefined"?h["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){c.style.backgroundColor=n["color"]}var p=this.prepareHeader(BX.type.isNotEmptyString(h["title"])?h["title"]:this.getMessage("untitled"));c.appendChild(p);t=this.prepareItemHtml(h);e=BX.type.isNotEmptyString(h["url"])?h["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var u=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]})]});c.appendChild(u)}var f=BX.create("DIV",{attrs:{className:"crm-widget-total-right"}});g.appendChild(f);if(l){i=typeof l["display"]!=="undefined"?l["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){f.style.backgroundColor=n["color"]}var _=this.prepareHeader(BX.type.isNotEmptyString(l["title"])?l["title"]:this.getMessage("untitled"));f.appendChild(_);t=this.prepareItemHtml(l);e=BX.type.isNotEmptyString(l["url"])?l["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});var m=BX.create("DIV",{attrs:{className:"crm-widget-content"},children:[BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]})]});f.appendChild(m)}}else{BX.addClass(this._wrapper,"crm-widget-number");var C=BX.type.isArray(this._data["items"])&&this._data["items"].length>0?this._data["items"][0]:null;if(!C){return}i=typeof C["display"]!=="undefined"?C["display"]:{};n=BX.CrmWidgetColorScheme.getInfo(BX.type.isNotEmptyString(i["colorScheme"])?i["colorScheme"]:"");if(n){this._wrapper.style.backgroundColor=n["color"]}this._headerWrapper=this.prepareHeader(BX.type.isNotEmptyString(C["title"])?C["title"]:this.getMessage("untitled"),s);this._wrapper.appendChild(this._headerWrapper);this._contentWrapper=BX.create("DIV",{attrs:{id:this._prefix+"_"+"content_wrapper",className:"crm-widget-content"}});this._wrapper.appendChild(this._contentWrapper);t=this.prepareItemHtml(C);e=BX.type.isNotEmptyString(C["url"])?C["url"]:"";r=e!==""?BX.create("A",{attrs:{className:"crm-widget-content-text"},props:{href:e},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}}):BX.create("SPAN",{attrs:{className:"crm-widget-content-text"},html:t,style:{fontSize:"48px",lineHeight:"56px",opacity:1}});if(o!==""){this._contentWrapper.appendChild(BX.create("SPAN",{attrs:{className:"crm-widget-content-period"},children:[BX.create("SPAN",{html:this.getMessage("periodCaption")+": "+o})]}))}this._contentWrapper.appendChild(BX.create("DIV",{attrs:{className:"crm-widget-content-amt"},children:[r]}))}this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"));this._widowResizeHandler=BX.throttle(BX.delegate(this.onWidowResize,this),300);BX.bind(window,"resize",this._widowResizeHandler)};BX.CrmNumericWidget.prototype.prepareItemHtml=function(t){var e="";if(BX.type.isNotEmptyString(t["html"])){e=t["html"]}else if(BX.type.isNotEmptyString(t["text"])){e=BX.util.htmlspecialchars(t["text"])}else if(BX.type.isNotEmptyString(t["value"])){var i=t["value"];var n=typeof t["format"]!=="undefined"?t["format"]:{};if(BX.type.isNotEmptyString(n["isPercent"])&&n["isPercent"]==="Y"){i+="%"}e=BX.util.htmlspecialchars(i)}return e};BX.CrmNumericWidget.prototype.innerClearLayout=function(){BX.unbind(window,"resize",this._widowResizeHandler);this._widowResizeHandler=null};BX.CrmNumericWidget.prototype.ensureConfigEditorCreated=function(){if(!this._configEditor){this._configEditor=BX.CrmNumericWidgetConfigEditor.create(this._id+"_config",{widget:this,config:this._config,entityTypeName:this.getEntityTypeName()})}};BX.CrmNumericWidget.prototype.getHeight=function(){return this._layout==="tiled"?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half};BX.CrmNumericWidget.prototype.onWidowResize=function(t){if(this._hasLayout&&this._wrapper){this.ajustFontSize(this._wrapper.querySelectorAll(".crm-widget-content-text"))}};BX.CrmNumericWidget.prototype.ajustFontSize=function(t){var e=0;var i=0;var n=true;var r=true;var s=0;if(!t)return;for(var o=0;o<t.length;o++){e=parseInt(BX.style(t[o],"font-size"));if(!s)s=72;else s=53;n=t[o].offsetWidth>t[o].parentNode.offsetWidth-20;r=t[o].offsetWidth<t[o].parentNode.offsetWidth-20;while(t[o].offsetWidth>t[o].parentNode.offsetWidth-20&&n){e-=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";r=false}while(t[o].offsetWidth<t[o].parentNode.offsetWidth-20&&e<s&&r){e+=2;t[o].style.fontSize=e+"px";t[o].style.lineHeight=e+8+"px";n=false}if(!i&&o>0)i=e;if(o>0)i=Math.min(i,e)}for(var a=0;a<t.length;a++){t[a].style.opacity=1;if(a>0){t[a].style.fontSize=i+"px";t[a].style.lineHeight=i+8+"px"}}};BX.CrmNumericWidget.create=function(t,e){var i=new BX.CrmNumericWidget;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigEditor==="undefined"){BX.CrmWidgetConfigEditor=function(){this._id="";this._settings=null;this._entityTypeName="";this._widget=null;this._config=null;this._enableTitle=false;this._dlg=null;this._container=null;this._leadingWrapper=null;this._titleEditor=null;this._period=null};BX.CrmWidgetConfigEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._widget=this.getSetting("widget");if(!this._widget){throw"BX.CrmWidgetConfigEditor: Could not find widget parameter."}this._config=this.getSetting("config");if(!this._config){throw"BX.CrmWidgetConfigEditor: Could not find config parameter."}this._enableTitle=this.getSetting("enableTitle",false);this.doInitialize()},doInitialize:function(){},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getEntityTypeName:function(){return this._entityTypeName},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:{content:this.prepareDialogTitle()},content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButton({text:this.getMessage("dialogSaveButton"),className:"popup-window-button-accept",events:{click:BX.delegate(this.onDialogAcceptButtonClick,this)}}),new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},prepareDialogTitle:function(){return BX.create("SPAN",{attrs:{className:"bx-lists-dialog-title"},text:this.getMessage("dialogTitle")})},prepareDialogContent:function(){this._container=BX.create("DIV",{});this._leadingWrapper=BX.create("DIV",{attrs:{className:"container-item"}});this._container.appendChild(this._leadingWrapper);if(this._enableTitle){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#b0b6bc",enableBackgroundColorChange:false});this._titleEditor.prepareLayout(this._leadingWrapper)}this._period=BX.CrmWidgetConfigPeriodEditor.create(this._id+"_period",{isNested:true,config:BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{}});this._period.prepareLayout(this._leadingWrapper);this.innerPrepareDialogContent(this._container);return this._container},innerPrepareDialogContent:function(t){},reset:function(){},getWidget:function(){return this._widget},getConfig:function(){return this._config},saveConfig:function(){this._period.saveConfig();if(this._enableTitle&&this._titleEditor){this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle()}if(this._entityTypeName!==""){this._config["entityTypeName"]=this._entityTypeName}this._config["filter"]=this._period.getConfig();this.innerSaveConfig()},innerSaveConfig:function(){},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this.reset();this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogAcceptButtonClick:function(){this._widget.processConfigSave();this.closeDialog()},onDialogCancelButtonClick:function(){this.closeDialog()}};if(typeof BX.CrmWidgetConfigEditor.messages==="undefined"){BX.CrmWidgetConfigEditor.messages={}}BX.CrmWidgetConfigEditor.createSelect=function(t,e){var i=BX.create("SELECT",t);this.setupSelectOptions(i,e);return i};BX.CrmWidgetConfigEditor.setupSelectOptions=function(t,e){while(t.options.length>0){t.remove(0)}var i=null;var n="";for(var r=0;r<e.length;r++){var s=e[r];var o=BX.type.isNotEmptyString(s["group"])?s["group"]:"";if(o!==""&&o!==n){n=o;i=document.createElement("OPTGROUP");i.label=o;t.appendChild(i)}var a=BX.type.isNotEmptyString(s["value"])?s["value"]:"";var h=BX.type.isNotEmptyString(s["text"])?s["text"]:s["value"];var l=new Option(h,a,false,false);var d=BX.type.isPlainObject(s["attrs"])?s["attrs"]:null;

if(d){for(var g in d){if(!d.hasOwnProperty(g)){continue}l.setAttribute("data-"+g,d[g])}}if(i){i.appendChild(l)}else{if(!BX.browser.IsIE()){t.add(l,null)}else{try{t.add(l,t.options[null])}catch(c){t.add(l,null)}}}}};BX.CrmWidgetConfigEditor.create=function(t,e){var i=new BX.CrmWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPeriodEditor==="undefined"){BX.CrmWidgetConfigPeriodEditor=function(){this._id="";this._settings=null;this._isNested=false;this._enableEmpty=true;this._config=null;this._period="";this._curYear=0;this._curMonth=0;this._curQuarter=0;this._year=0;this._quarter=0;this._month=0;this._periodSelector=null;this._yearSelector=null;this._quarterSelector=null;this._monthSelector=null;this._yearSelectorWrapper=null;this._quarterSelectorWrapper=null;this._monthSelectorWrapper=null;this._periodChangeHandler=BX.delegate(this.onPeriodChange,this);this._yearChangeHandler=BX.delegate(this.onYearChange,this);this._quarterChangeHandler=BX.delegate(this.onQuarterChange,this);this._monthChangeHandler=BX.delegate(this.onMonthChange,this);this._changeNotifier=null};BX.CrmWidgetConfigPeriodEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._isNested=this.getSetting("isNested",false);this._config=this.getSetting("config",{});this._period=BX.type.isNotEmptyString(this._config["periodType"])?this._config["periodType"].toUpperCase():this.getDefaultPeriod();this._enableEmpty=BX.type.isBoolean(this._config["enableEmpty"])?this._config["enableEmpty"]:true;var i=new Date;this._curYear=i.getFullYear();this._curMonth=i.getMonth()+1;this._curQuarter=this._curMonth>=10?4:this._curMonth>=7?3:this._curMonth>=4?2:1;this._year=typeof this._config["year"]!=="undefined"?parseInt(this._config["year"]):this._curYear;this._quarter=typeof this._config["quarter"]!=="undefined"?parseInt(this._config["quarter"]):this._curQuarter;this._month=typeof this._config["month"]!=="undefined"?parseInt(this._config["month"]):this._curMonth;this._changeNotifier=BX.CrmNotifier.create(this);var n=this.getSetting("controls");if(BX.type.isPlainObject(n)){this._yearSelectorWrapper=BX(n["yearWrap"]);this._quarterSelectorWrapper=BX(n["quarterWrap"]);this._monthSelectorWrapper=BX(n["monthWrap"]);this._periodSelector=BX(n["period"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._periodSelector,this.preparePeriodListItems());this._periodSelector.value=this._period;BX.bind(this._periodSelector,"change",this._periodChangeHandler);this._yearSelector=BX(n["year"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._yearSelector,this.prepareYearListItems());this._yearSelector.value=this._year;BX.bind(this._yearSelector,"change",this._yearChangeHandler);this._quarterSelector=BX(n["quarter"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._quarterSelector,this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;BX.bind(this._quarterSelector,"change",this._quarterChangeHandler);this._monthSelector=BX(n["month"]);BX.CrmWidgetConfigEditor.setupSelectOptions(this._monthSelector,this.prepareMonthListItems());this._monthSelector.value=this._month;BX.bind(this._monthSelector,"change",this._monthChangeHandler);this.adjust()}BX.onCustomEvent(window,"CrmWidgetConfigPeriodEditorCreate",[this])},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPeriodEditor.messages;return e.hasOwnProperty(t)?e[t]:t},isNested:function(){return this._isNested},getDefaultPeriod:function(){return this.getSetting("defaultPeriodType",BX.CrmWidgetFilterPeriod.undefined)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t;this._periodSelector.value=t;this.adjust();this._changeNotifier.notify()},getYear:function(){return this._year},setYear:function(t){this._year=t;this._yearSelector.value=t;this._changeNotifier.notify()},getQuarter:function(){return this._quarter},setQuarter:function(t){this._quarter=t;this._quarterSelector.value=t;this._changeNotifier.notify()},getMonth:function(){return this._month},setMonth:function(t){this._month=t;this._monthSelector.value=t;this._changeNotifier.notify()},addChangeListener:function(t){this._changeNotifier.addListener(t)},removeChangeListener:function(t){this._changeNotifier.removeListener(t)},prepareYearListItems:function(){var t=[];for(var e=this._curYear-20;e<=this._curYear+20;e++){t.push({value:e.toString(),text:e.toString()})}return t},prepareQuarterListItems:function(){return[{value:"1",text:"I"},{value:"2",text:"II"},{value:"3",text:"III"},{value:"4",text:"IV"}]},prepareMonthListItems:function(){var t=[];var e=BX.CrmWidgetConfigPeriodEditor.getMonthNames();for(var i=1;i<=12;i++){t.push({value:i.toString(),text:e[i-1]})}return t},preparePeriodListItems:function(){return!this._isNested?BX.CrmWidgetFilterPeriod.prepareListItems({},!this._enableEmpty):this._enableEmpty?BX.CrmWidgetFilterPeriod.prepareListItems({"":this.getMessage("accordingToFilter")},false):BX.CrmWidgetFilterPeriod.prepareListItems({},true)},prepareLayout:function(t){this._periodSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._periodChangeHandler}},this.preparePeriodListItems());this._periodSelector.value=this._period;this._yearSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._yearChangeHandler}},this.prepareYearListItems());this._yearSelector.value=this._year;this._yearSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-year"},children:[this._yearSelector]});this._quarterSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._quarterChangeHandler}},this.prepareQuarterListItems());this._quarterSelector.value=this._quarter;this._quarterSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-quarter"},children:[this._quarterSelector]});this._monthSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._monthChangeHandler}},this.prepareMonthListItems());this._monthSelector.value=this._month;this._monthSelectorWrapper=BX.create("SPAN",{attrs:{className:"select-container select-container-period select-container-period-month"},children:[this._monthSelector]});t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-period field-container-small field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._periodSelector]}),this._monthSelectorWrapper,this._quarterSelectorWrapper,this._yearSelectorWrapper]}));this.adjust()},resetLayout:function(){},saveConfig:function(){this._config["periodType"]=this._period;if(this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month){this._config["year"]=this._year}if(this._period===BX.CrmWidgetFilterPeriod.quarter){this._config["quarter"]=this._quarter}if(this._period===BX.CrmWidgetFilterPeriod.month){this._config["month"]=this._month}},getConfig:function(){return this._config},isEmpty:function(){return this._period===BX.CrmWidgetFilterPeriod.undefined},getDescription:function(){var t;if(this._period===BX.CrmWidgetFilterPeriod.undefined){return""}else if(this._period===BX.CrmWidgetFilterPeriod.year){return this.getMessage("yearDescription").replace(/#YEAR#/gi,this._year)}else if(this._period===BX.CrmWidgetFilterPeriod.quarter){var e=3*this._quarter;var i=e-2;t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("quarterDescription").replace(/#YEAR#/gi,this._year).replace(/#FIRST_MONTH#/gi,t[i-1]).replace(/#LAST_MONTH#/gi,t[e-1])}else if(this._period===BX.CrmWidgetFilterPeriod.month){t=BX.CrmWidgetConfigPeriodEditor.getMonthNames();return this.getMessage("monthDescription").replace(/#YEAR#/gi,this._year).replace(/#MONTH#/gi,t[this._month-1])}else if(this._period===BX.CrmWidgetFilterPeriod.currentMonth){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentMonth).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.currentQuarter){return BX.CrmWidgetFilterPeriod.getDescription(BX.CrmWidgetFilterPeriod.currentQuarter).toLowerCase()}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays90){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,90)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays60){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,60)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays30){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,30)}else if(this._period===BX.CrmWidgetFilterPeriod.lastDays7){return this.getMessage("lastDaysDescription").replace(/#DAYS#/gi,7)}return""},adjust:function(){this._yearSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.year||this._period===BX.CrmWidgetFilterPeriod.quarter||this._period===BX.CrmWidgetFilterPeriod.month?"":"none";this._quarterSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.quarter?"":"none";this._monthSelectorWrapper.style.display=this._period===BX.CrmWidgetFilterPeriod.month?"":"none"},onPeriodChange:function(t){this._period=this._periodSelector.value;this.adjust();this._changeNotifier.notify()},onYearChange:function(t){this._year=parseInt(this._yearSelector.value);this._changeNotifier.notify()},onQuarterChange:function(t){this._quarter=parseInt(this._quarterSelector.value);this._changeNotifier.notify()},onMonthChange:function(t){this._month=parseInt(this._monthSelector.value);this._changeNotifier.notify()}};BX.CrmWidgetConfigPeriodEditor.monthNames=null;BX.CrmWidgetConfigPeriodEditor.getMonthNames=function(){if(!this.monthNames){this.monthNames=[];for(var t=1;t<=12;t++){this.monthNames.push(BX.message["MONTH_"+t.toString()])}}return this.monthNames};if(typeof BX.CrmWidgetConfigPeriodEditor.messages==="undefined"){BX.CrmWidgetConfigPeriodEditor.messages={}}BX.CrmWidgetConfigPeriodEditor.items={};BX.CrmWidgetConfigPeriodEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPeriodEditor;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetConfigTitleEditor==="undefined"){BX.CrmWidgetConfigTitleEditor=function(){this._id="";this._settings=null;this._config=null;this._mode=BX.CrmWidgetConfigControlMode.undifined;this._title="";this._titleBackgroundColor="";this._letter="";this._schemeId="";this._titleInput=null;this._titleEditButton=null;this._titleSaveButton=null;this._schemeSelectButton=null;this._enableScemeChange=true;this._deleteButton=null;this._enableDeletion=false;this._wrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;this._titleWrapper=null;this._inputKeyDownHandler=BX.delegate(this.onInputKeyDown,this);this._titleEitButtonClickHandler=BX.delegate(this.onTitleEditButtonClick,this);this._titleSaveButtonClickHandler=BX.delegate(this.onTitleSaveButtonClick,this);this._schemeSelectButtonCkickHandler=BX.delegate(this.onSchemeSelectButtonClick,this);this._isSchemeMenuShown=false;this._schemeMenuId="";this._schemeMenu=null;this._schemeMenuHandler=BX.delegate(this.onSchemeMenuItemClick,this);this._schemeChangeNotifier=null;this._deleteButtonCkickHandler=BX.delegate(this.onDeleteButtonClick,this);this._deletionNotifier=null};BX.CrmWidgetConfigTitleEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._title=BX.type.isNotEmptyString(this._config["title"])?this._config["title"]:"";this._letter=this.getSetting("letter","");this._titleBackgroundColor=this.getSetting("backgroundColor","#22d02c");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}this._mode=BX.CrmWidgetConfigControlMode.view;this._enableScemeChange=this.getSetting("enableBackgroundColorChange",true);this._schemeChangeNotifier=BX.CrmNotifier.create(this);this._enableDeletion=this.getSetting("enableDeletion",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigTitleEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},getTitle:function(){return this._title},setTitle:function(t){this._title=t;if(this._titleInput){this._titleInput.value=t}if(this._titleViewContainer){this._titleViewContainer.innerHTML=BX.util.htmlspecialchars(t)}},getName:function(){return this._name},getTitleBackgroundColor:function(){return this._titleBackgroundColor},prepareLayout:function(t){this._titleEditButton=BX.create("SPAN",{attrs:{className:"field-title-icon-edit"},events:{click:this._titleEitButtonClickHandler}});this._titleSaveButton=BX.create("SPAN",{attrs:{className:"field-title-icon-ready"},events:{click:this._titleSaveButtonClickHandler},style:{display:"none"}});var e=this._title!==""?this._title:this.getMessage("untitled");this._titleViewContainer=BX.create("SPAN",{attrs:{className:"title-name"},text:e});this._titleInput=BX.create("INPUT",{props:{type:"text",placeholder:this.getTitle("placeholder")}});this._titleEditContainer=BX.create("SPAN",{attrs:{className:"fiedl-title-input-container"},children:[this._titleInput],style:{display:"none"}});var i=[];if(this._letter!==""){i.push(BX.create("SPAN",{attrs:{className:"field-title-letter"},text:this._letter}))}i.push(this._titleViewContainer);i.push(this._titleEditContainer);this._titleWrapper=BX.create("SPAN",{attrs:{className:"field-title-title-inner"},children:[BX.create("SPAN",{attrs:{className:"field-title-name"},children:i}),this._titleEditButton,this._titleSaveButton]});var n=BX.create("DIV",{attrs:{className:"field-title-panel"}});if(this._enableScemeChange){this._schemeSelectButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-bucket"},events:{click:this._schemeSelectButtonCkickHandler}});n.appendChild(this._schemeSelectButton)}if(this._enableDeletion){this._deleteButton=BX.create("DIV",{attrs:{className:"field-title-panel-button field-title-button-close"},events:{click:this._deleteButtonCkickHandler}});n.appendChild(this._deleteButton)}this._wrapper=BX.create("DIV",{attrs:{className:"field-title"},style:{backgroundColor:this._titleBackgroundColor},children:[n,BX.create("SPAN",{attrs:{className:"field-title-title"},children:[this._titleWrapper]})]});t.appendChild(this._wrapper);return t},resetLayout:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}if(this._titleEditButton){BX.unbind(this._titleEditButton,"click",this._titleEitButtonClickHandler);this._titleEditButton=null}if(this._titleSaveButton){BX.unbind(this._titleSaveButton,"click",this._titleSaveButtonClickHandler);this._titleSaveButton=null}if(this._schemeSelectButton){BX.unbind(this._schemeSelectButton,"click",this._schemeSelectButtonCkickHandler);this._schemeSelectButton=null}this._titleInput=null;this._titleWrapper=null;this._titleViewContainer=null;this._titleEditContainer=null;BX.cleanNode(this._wrapper,true);this._wrapper=null},getConfig:function(){return this._config},getColorSchemeId:function(){return this._schemeId},saveConfig:function(){if(this._mode===BX.CrmWidgetConfigControlMode.edit){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}this._config["title"]=this._title;if(this._schemeId!==""){if(typeof this._config["display"]==="undefined"){this._config["display"]={}}this._config["display"]["colorScheme"]=this._schemeId}else if(typeof this._config["display"]!=="undefined"){delete this._config["display"]["colorScheme"]}},switchMode:function(t){if(this._mode===t){return}if(t===BX.CrmWidgetConfigControlMode.view){BX.unbind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.blur();BX.removeClass(this._titleWrapper,"input-container-edit");this._titleSaveButton.style.display="none";this._titleEditContainer.style.display="none";this._titleEditButton.style.display="";this._titleViewContainer.style.display=""}else if(t===BX.CrmWidgetConfigControlMode.edit){BX.addClass(this._titleWrapper,"input-container-edit");this._titleEditButton.style.display="none";this._titleViewContainer.style.display="none";this._titleSaveButton.style.display="";this._titleEditContainer.style.display="";BX.bind(this._titleInput,"keydown",this._inputKeyDownHandler);this._titleInput.focus()}this._mode=t},addColorSchemeChangeListener:function(t){this._schemeChangeNotifier.addListener(t)},removeColorSchemeChangeListener:function(t){this._schemeChangeNotifier.removeListener(t)},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},onTitleEditButtonClick:function(t){this.initInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.edit)},onTitleSaveButtonClick:function(t){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)},saveInputValue:function(){this._title=this._titleInput.value;this._titleViewContainer.innerHTML=this._title!==""?BX.util.htmlspecialchars(this._title):this.getMessage("untitled")},initInputValue:function(){this._titleInput.value=this._title},onInputKeyDown:function(t){if(this._mode!==BX.CrmWidgetConfigControlMode.edit){return}t=t||window.event;if(t.keyCode===13){this.saveInputValue();this.switchMode(BX.CrmWidgetConfigControlMode.view)}else if(t.keyCode===27){this.switchMode(BX.CrmWidgetConfigControlMode.view)}},onSchemeSelectButtonClick:function(t){if(!this._isSchemeMenuShown){this.openSchemeMenu()}else{this.closeSchemeMenu()}},onDeleteButtonClick:function(t){this._deletionNotifier.notify()},openSchemeMenu:function(){if(this._isSchemeMenuShown){return}this._schemeMenuId=this._id+"_scheme_menu";if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._schemeMenu=BX.PopupMenu.create(this._schemeMenuId,this._schemeSelectButton,BX.CrmWidgetColorScheme.prepareMenuItems(this._schemeMenuHandler),{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSchemeMenuClose,this)}});this._schemeMenu.popupWindow.show();this._isSchemeMenuShown=true},closeSchemeMenu:function(){if(this._schemeMenu&&this._schemeMenu.popupWindow){this._schemeMenu.popupWindow.close()}},onSchemeMenuClose:function(){this._schemeMenu=null;if(typeof BX.PopupMenu.Data[this._schemeMenuId]!=="undefined"){BX.PopupMenu.Data[this._schemeMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._schemeMenuId]}this._isSchemeMenuShown=false},onSchemeMenuItemClick:function(t,e){this._schemeId=e.id;var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i&&this._wrapper){this._wrapper.style.backgroundColor=this._titleBackgroundColor=i["color"]}this.closeSchemeMenu();this._schemeChangeNotifier.notify()}};if(typeof BX.CrmWidgetConfigTitleEditor.messages==="undefined"){BX.CrmWidgetConfigTitleEditor.messages={}}BX.CrmWidgetConfigTitleEditor.create=function(t,e){var i=new BX.CrmWidgetConfigTitleEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigPresetEditor==="undefined"){BX.CrmWidgetConfigPresetEditor=function(){this._id="";this._settings=null;this._config=null;this._entityTypeName="";this._contextId="";this._enableContextChange=true;this._semanticId="";this._categoryName="";this._preset=null;this._typeSelector=null;this._enableSemanticsChange=true;this._presetSelector=null;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._typeChangeHandler=BX.delegate(this.onTypeChange,this);this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._presetChangeCallback=null;this._container=null;this._semanticsWrapper=null;this._presetWrapper=null};BX.CrmWidgetConfigPresetEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._preset=BX.CrmWidgetDataPreset.getItem(BX.type.isNotEmptyString(this._config["dataPreset"])?this._config["dataPreset"]:this._config["name"]);this._entityTypeName=this._preset&&BX.type.isNotEmptyString(this._preset["entity"])?this._preset["entity"]:this.getSetting("entityTypeName","");var i=BX.type.isPlainObject(this._config["filter"])?this._config["filter"]:{};this._semanticId=BX.type.isNotEmptyString(i["semanticID"])?i["semanticID"]:"";this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.undefined);if(this._contextId===BX.CrmWidgetDataContext.undefined){this._contextId=this._preset?this._preset["context"]:BX.CrmWidgetDataContext.entity}this._categoryName=this.getSetting("category","");if(this._categoryName===""){this._categoryName=this._preset&&BX.type.isNotEmptyString(this._preset["category"])?this._preset["category"]:""}this._presetChangeCallback=this.getSetting("presetChange",null);this._enableContextChange=this.getSetting("enableContextChange",true)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigPresetEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getId:function(){return this._id},prepareLayout:function(t,e){this._container=t;var i=null;if(this._enableContextChange){i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var n=BX.CrmWidgetDataContext.descriptions;for(var r in n){if(!n.hasOwnProperty(r)||r===BX.CrmWidgetDataContext.undefined){continue}var s=n[r];var o=this.getId()+"_data_context";var a=o+"_"+r.toLowerCase();this._contextSwitches[r]=BX.create("INPUT",{props:{type:"radio",id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===r){this._contextSwitches[r].checked=true}i.appendChild(this._contextSwitches[r]);i.appendChild(BX.create("LABEL",{attrs:{"for":a},text:s}))}}var h=BX.CrmPhaseSemantics.getSelectorTitle(this._entityTypeName);if(h===""){h=this.getMessage("semanticsCaption")}var l=[{value:"",text:this.getMessage("notSelected")}];var d=BX.CrmPhaseSemantics.prepareListItems(this._entityTypeName);var g=BX.CrmPhaseSemantics.getGroupTitle(this._entityTypeName);for(var c=0;c<d.length;c++){var p=d[c];if(p["value"]!==""){p["attrs"]={context:"semantics"};p["group"]=g;l.push(p)}}var u=BX.CrmWidgetDataCategory.prepareListItems(this._entityTypeName);for(var f=0;f<u.length;f++){var _=u[f];if(_["value"]!==""){_["attrs"]={context:"category"};_["group"]=BX.CrmWidgetDataCategory.groupTitle;l.push(_)}}this._typeSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._typeChangeHandler}},l);if(this._semanticId!==""){this._typeSelector.value=this._semanticId}else if(this._categoryName!==""){this._typeSelector.value=this._categoryName}this._presetSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._presetChangeHandler}},BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId));if(this._preset){this._presetSelector.value=this._preset["name"]}if(!BX.type.isNotEmptyString(e)){e=""}if(e==="wide"){this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container field-container-right"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container field-container-left"},children:[i]}))}}else{this._semanticsWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:h+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._typeSelector]})]});t.appendChild(this._semanticsWrapper);if(this._enableContextChange){t.appendChild(BX.create("DIV",{attrs:{className:"field-container"},children:[i]}))}this._presetWrapper=BX.create("DIV",{attrs:{className:"field-container"},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("nameCaption")+":"}),BX.create("SPAN",{attrs:{className:"select-container"},children:[this._presetSelector]})]});t.appendChild(this._presetWrapper)}},resetLayout:function(){if(this._presetSelector){BX.unbind(this._presetSelector,"change",this._presetChangeHandler);this._presetSelector=null}if(this._typeSelector){BX.unbind(this._typeSelector,"change",this._typeChangeHandler);this._typeSelector=null}for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler)}this._contextSwitches={};this._semanticsWrapper=this._presetWrapper=null;BX.cleanNode(this._container,false)},getContextId:function(){return this._preset?this._preset["context"]:this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId))},saveConfig:function(){if(this._semanticId!==BX.CrmPhaseSemantics.undefined){if(!BX.type.isPlainObject(this._config["filter"])){this._config["filter"]={}}this._config["filter"]["semanticID"]=this._semanticId}else if(BX.type.isPlainObject(this._config["filter"])){delete this._config["filter"]["semanticID"]}if(this._preset){if(this._config["title"]===""){this._config["title"]=this._preset["title"]}this._config["dataPreset"]=this._preset["name"];this._config["dataSource"]=this._preset["source"];this._config["select"]=this._preset["select"];var t=this.getContextId();if(t===BX.CrmWidgetDataContext.fund){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}if(t===BX.CrmWidgetDataContext.percent){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isPercent"]="Y"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isPercent"]}}},getConfig:function(){return this._config},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}},onTypeChange:function(t){var e=this._typeSelector.selectedIndex;var i=e>=0?this._typeSelector.options[e]:null;if(!i){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=""}else{var n=i.getAttribute("data-context","");if(n==="category"){this._semanticId=BX.CrmPhaseSemantics.undefined;this._categoryName=i.value}else{this._semanticId=i.value;this._categoryName=""}}var r=this._presetSelector.value;BX.CrmWidgetConfigEditor.setupSelectOptions(this._presetSelector,BX.CrmWidgetDataPreset.prepareListItems(this._entityTypeName,this._categoryName,this._contextId));for(var s=0;s<this._presetSelector.options.length;s++){if(this._presetSelector.options[s].value===r){this._presetSelector.value=r;break}}},onPresetChange:function(t){this._preset=BX.CrmWidgetDataPreset.getItem(this._presetSelector.value);if(BX.type.isFunction(this._presetChangeCallback)){this._presetChangeCallback(this,this._preset)}}};if(typeof BX.CrmWidgetConfigPresetEditor.messages==="undefined"){BX.CrmWidgetConfigPresetEditor.messages={}}BX.CrmWidgetConfigPresetEditor.create=function(t,e){var i=new BX.CrmWidgetConfigPresetEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigGroupingEditor==="undefined"){BX.CrmWidgetConfigGroupingEditor=function(){this._id="";this._settings=null;this._config=null;this._control=null;this._grouping="";this._groupingSelector=null;this._groupingChangeHandler=BX.delegate(this.onGroupingChange,this)};BX.CrmWidgetConfigGroupingEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._control=this.getSetting("control",null);if(!this._control){throw"BX.CrmWidgetConfigGroupingEditor: Could not find 'control' parameter."}this._config=this.getSetting("config",{});this._grouping=BX.type.isNotEmptyString(this._config["group"])?this._config["group"].toUpperCase():this._control.getDefault()},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetConfigGroupingEditor.messages;return e.hasOwnProperty(t)?e[t]:t},getGrouping:function(){return this._grouping},prepareLayout:function(t,e){this._groupingSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._groupingChangeHandler}},this._control.prepareListItems());this._groupingSelector.value=this._grouping;var i="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){i+=" field-container-left"}else if(e==="right"){i+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:i},children:[BX.create("LABEL",{attrs:{className:"field-container-title"},text:this.getMessage("caption")+":"}),BX.create("SPAN",{attrs:{className:"select-container select-container-period"},children:[this._groupingSelector]})]}))},resetLayout:function(){if(this._groupingSelector){BX.unbind(this._groupingSelector,"change",this._groupingChangeHandler);this._groupingSelector=null}},saveConfig:function(){this._config["group"]=this._grouping},getConfig:function(){return this._config},onGroupingChange:function(t){this._grouping=this._groupingSelector.value}};if(typeof BX.CrmWidgetConfigGroupingEditor.messages==="undefined"){BX.CrmWidgetConfigGroupingEditor.messages={}}BX.CrmWidgetConfigGroupingEditor.create=function(t,e){var i=new BX.CrmWidgetConfigGroupingEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetConfigContextEditor==="undefined"){BX.CrmWidgetConfigContextEditor=function(){this._id="";this._settings=null;this._config=null;this._contextId=BX.CrmWidgetDataContext.undefined;this._contextSwitches={};this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._contextChangeCallback=null};BX.CrmWidgetConfigContextEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._config=this.getSetting("config",{});this._contextId=BX.type.isNotEmptyString(this._config["context"])?this._config["context"]:BX.CrmWidgetDataContext.entity;this._contextChangeCallback=this.getSetting("contextChange",null)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},prepareLayout:function(t,e){var i=BX.create("SPAN",{attrs:{className:"radiobox-container"}});var n=BX.CrmWidgetDataContext.descriptions;for(var r in n){if(!n.hasOwnProperty(r)||r===BX.CrmWidgetDataContext.undefined){continue}var s=n[r];var o=this.getId()+"_data_context";var a=o+"_"+r.toLowerCase();this._contextSwitches[r]=BX.create("INPUT",{props:{type:"radio",
id:a,name:o},events:{click:this._contextChangeHandler}});if(this._contextId===r){this._contextSwitches[r].checked=true}i.appendChild(this._contextSwitches[r]);i.appendChild(BX.create("LABEL",{attrs:{"for":a},text:s}))}var h="field-container";if(BX.type.isNotEmptyString(e)){if(e==="left"){h+=" field-container-left"}else if(e==="right"){h+=" field-container-right"}}t.appendChild(BX.create("DIV",{attrs:{className:h},children:[i]}))},resetLayout:function(){for(var t in this._contextSwitches){if(!this._contextSwitches.hasOwnProperty(t)){continue}BX.unbind(this._contextSwitches[t],"click",this._contextChangeHandler)}this._contextSwitches={}},getContextId:function(){return this._contextId},setContextId:function(t){if(this._contextId===t){return}this._contextId=t;if(BX.type.isFunction(this._contextChangeCallback)){this._contextChangeCallback(this,this._contextId)}},saveConfig:function(){this._config["context"]=this._contextId},getConfig:function(){return this._config},onContextChange:function(t){if(this._contextId!==BX.CrmWidgetDataContext.fund&&this._contextSwitches[BX.CrmWidgetDataContext.fund].checked){this.setContextId(BX.CrmWidgetDataContext.fund)}else if(this._contextId!==BX.CrmWidgetDataContext.entity&&this._contextSwitches[BX.CrmWidgetDataContext.entity].checked){this.setContextId(BX.CrmWidgetDataContext.entity)}else if(this._contextId!==BX.CrmWidgetDataContext.percent&&this._contextSwitches[BX.CrmWidgetDataContext.percent].checked){this.setContextId(BX.CrmWidgetDataContext.percent)}}};BX.CrmWidgetConfigContextEditor.create=function(t,e){var i=new BX.CrmWidgetConfigContextEditor;i.initialize(t,e);return i}}if(typeof BX.CrmRatingWidgetConfigEditor==="undefined"){BX.CrmRatingWidgetConfigEditor=function(){BX.CrmRatingWidgetConfigEditor.superclass.constructor.apply(this);this._config=null;this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this)};BX.extend(BX.CrmRatingWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmRatingWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:"#43a4af",enableBackgroundColorChange:false});var e=BX.type.isArray(this._config["configs"])&&this._config["configs"].length>0?this._config["configs"][0]:{};this._presetEditor=BX.CrmWidgetConfigPresetEditor.create(this._id,{config:e,presetChange:this._presetChangeHandler,entityTypeName:this.getEntityTypeName()});var i=BX.create("DIV",{attrs:{className:"container-item container-item-center"}});t.appendChild(i);this._titleEditor.prepareLayout(i);this._presetEditor.prepareLayout(i,"wide");return t};BX.CrmRatingWidgetConfigEditor.prototype.innerSaveConfig=function(){this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this._presetEditor.saveConfig();this._config["configs"]=[this._presetEditor.getConfig()]};BX.CrmRatingWidgetConfigEditor.prototype.reset=function(){this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;this._period.resetLayout();this._period=null};BX.CrmRatingWidgetConfigEditor.prototype.onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmRatingWidgetConfigEditor.create=function(t,e){var i=new BX.CrmRatingWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigEditor==="undefined"){BX.CrmNumericWidgetConfigEditor=function(){BX.CrmNumericWidgetConfigEditor.superclass.constructor.apply(this);this._fields=[]};BX.extend(BX.CrmNumericWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmNumericWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){var e=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var i,n;var r="";if(e.length===1){r="#43a4af"}for(i=0;i<e.length;i++){var s=e[i];var o=this._id+"_"+i;var a={config:s,index:i,parent:this,titleBackgroundColor:r,entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression(s)?BX.CrmNumericWidgetConfigExpressionFieldEditor.create(o,a):BX.CrmNumericWidgetConfigPresetFieldEditor.create(o,a))}for(i=0;i<this._fields.length;i++){this._fields[i].postInitialize()}var h=null;var l=[];for(i=0;i<this._fields.length;i++){var d=this._fields[i];if(i===0){t.appendChild(d.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}else{if(!h){h=BX.create("DIV",{attrs:{className:"container-item-wrapper"}});t.appendChild(h)}var g=BX.create("DIV",{attrs:{className:"container-item container-item-5 "+(i%2>0?"container-item-first":"container-item-second")}});h.appendChild(g);d.prepareLayout(g)}d.prepareExtraControls(l)}if(l.length>0){for(i=0;i<l.length;i++){var c=l[i];if(!BX.type.isArray(c["controls"])){continue}if(BX.type.isNotEmptyString(c["type"])&&c["type"]==="action"){var p=BX.create("DIV",{attrs:{className:"action-container"}});for(n=0;n<c["controls"].length;n++){p.appendChild(c["controls"][n])}if(h){t.insertBefore(p,h)}else{t.appendChild(p)}}else{for(n=0;n<c["controls"].length;n++){t.appendChild(c["controls"][n])}}}}return t};BX.CrmNumericWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmNumericWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmNumericWidgetConfigEditor.prototype.innerSaveConfig=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].saveConfig();this._config["configs"][t]=this._fields[t].getConfig()}};BX.CrmNumericWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._period.resetLayout();this._period=null};BX.CrmNumericWidgetConfigEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigEditor==="undefined"){BX.CrmGraphWidgetConfigEditor=function(){BX.CrmGraphWidgetConfigEditor.superclass.constructor.apply(this);this._grouping=null;this._context=null;this._fields=[];this._maxGraphCount=0;this._buttonContainer=null;this._addButton=null;this._contextChangeHandler=BX.delegate(this.onContextChange,this);this._fieldDeletionHandler=BX.delegate(this.onFieldDelete,this);this._addButtonClickHandler=BX.delegate(this.onAddButtonClick,this)};BX.extend(BX.CrmGraphWidgetConfigEditor,BX.CrmWidgetConfigEditor);BX.CrmGraphWidgetConfigEditor.prototype.doInitialize=function(){this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));if(isNaN(this._maxGraphCount)){this._maxGraphCount=0}};BX.CrmGraphWidgetConfigEditor.prototype.innerPrepareDialogContent=function(t){this._grouping=BX.CrmWidgetConfigGroupingEditor.create(this._id,{config:this._config,control:BX.CrmGraphWidgetDataGroup.create()});this._grouping.prepareLayout(this._leadingWrapper,"left");this._context=BX.CrmWidgetConfigContextEditor.create(this._id,{config:this._config,contextChange:this._contextChangeHandler});this._context.prepareLayout(this._leadingWrapper,"right");var e=this._context.getContextId();var i=BX.type.isArray(this._config["configs"])?this._config["configs"]:[];var n=this._maxGraphCount>0&&i.length<this._maxGraphCount?i.length:this._maxGraphCount;for(var r=0;r<n;r++){var s=i[r];var o=this._id+"_"+(r+1).toString();var a={config:s,context:e,parent:this,isNew:false,index:r,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};this._fields.push(BX.CrmGraphWidgetConfigFieldEditor.create(o,a))}for(var h=0;h<this._fields.length;h++){var l=this._fields[h];l.addDeletionListener(this._fieldDeletionHandler);t.appendChild(l.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"))}this._addButton=BX.create("A",{attrs:{className:"field-link",href:"#"},text:this.getMessage("addGraph")});this._buttonContainer=BX.create("DIV",{attrs:{className:"container-item container-item-button"},children:[this._addButton]});BX.bind(this._addButton,"click",this._addButtonClickHandler);t.appendChild(this._buttonContainer);return t};BX.CrmGraphWidgetConfigEditor.prototype.getMessage=function(t){if(BX.CrmGraphWidgetConfigEditor.messages.hasOwnProperty(t)){return BX.CrmGraphWidgetConfigEditor.messages[t]}return BX.CrmGraphWidgetConfigEditor.superclass.getMessage.apply(this,[t])};BX.CrmGraphWidgetConfigEditor.prototype.getFieldByName=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e];if(t===i.getName()){return i}}return null};BX.CrmGraphWidgetConfigEditor.prototype.getFields=function(){return this._fields};BX.CrmGraphWidgetConfigEditor.prototype.createField=function(){var t=0;for(var e=0;e<this._fields.length;e++){if(!this._fields[e].isDeleted()){t++}}if(t>=this._maxGraphCount){alert(this.getMessage("maxGraphError").replace(/#MAX_GRAPH_COUNT#/gi,this._maxGraphCount));return}var i=this._fields.length;var n=this._id+"_"+(i+1).toString();var r={config:{name:"param"+(i+1).toString()},context:this._context.getContextId(),parent:this,isNew:true,index:i,titleBackgroundColor:"",entityTypeName:this.getEntityTypeName()};var s=BX.CrmGraphWidgetConfigFieldEditor.create(n,r);this._fields.push(s);this._container.insertBefore(s.prepareLayout(BX.create("DIV",{attrs:{className:"container-item"}}),"wide"),this._buttonContainer);s.addDeletionListener(this._fieldDeletionHandler)};BX.CrmGraphWidgetConfigEditor.prototype.removeField=function(t){t.resetLayout()};BX.CrmGraphWidgetConfigEditor.prototype.removeConfig=function(t){if(!BX.type.isArray(this._config["configs"])){return}for(var e=0;e<this._config["configs"].length;e++){if(t===this._config["configs"][e]){this._config["configs"].splice(e,1);return}}};BX.CrmGraphWidgetConfigEditor.prototype.innerSaveConfig=function(){this._grouping.saveConfig();this._context.saveConfig();for(var t=0;t<this._fields.length;t++){var e=this._fields[t];if(!e.isDeleted()){e.saveConfig();if(e.isNew()){this._config["configs"].push(e.getConfig())}}else if(!e.isNew()){this.removeConfig(e.getConfig())}}};BX.CrmGraphWidgetConfigEditor.prototype.reset=function(){for(var t=0;t<this._fields.length;t++){this._fields[t].resetLayout()}this._fields=[];this._grouping.resetLayout();this._grouping=null;this._context.resetLayout();this._context=null;BX.unbind(this._addButton,"click",this._addButtonClickHandler);BX.cleanNode(this._buttonContainer,true);this._buttonContainer=null;this._addButton=null};BX.CrmGraphWidgetConfigEditor.prototype.onContextChange=function(t,e){for(var i=0;i<this._fields.length;i++){this._fields[i].setContextId(e)}};BX.CrmGraphWidgetConfigEditor.prototype.onFieldDelete=function(t){this.removeField(t)};BX.CrmGraphWidgetConfigEditor.prototype.onAddButtonClick=function(t){this.createField();return BX.PreventDefault(t)};if(typeof BX.CrmGraphWidgetConfigEditor.messages==="undefined"){BX.CrmGraphWidgetConfigEditor.messages={}}BX.CrmGraphWidgetConfigEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigFieldEditor==="undefined"){BX.CrmNumericWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._parent=null;this._name="";this._index=0;this._letter="";this._config=null;this._titleBackgroundColor="";this._titleEditor=null};BX.CrmNumericWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._parent=this.getSetting("parent");if(!this._parent){throw"CrmNumericWidgetConfigFieldEditor: Could not find 'parent' parameter."}this._index=this.getSetting("index",0);this._letter=String.fromCharCode(65+this._index);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");if(BX.type.isPlainObject(this._config["display"])&&BX.type.isNotEmptyString(this._config["display"]["colorScheme"])){this._schemeId=this._config["display"]["colorScheme"];var i=BX.CrmWidgetColorScheme.getInfo(this._schemeId);if(i){this._titleBackgroundColor=i["color"]}}if(this._titleBackgroundColor===""){if(this._index>1){this._titleBackgroundColor="#dec01f"}else if(this._index>0){this._titleBackgroundColor="#4fc3f7"}else{this._titleBackgroundColor="#22d02c"}}this.innerInitialize()},innerInitialize:function(){},postInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getLetter:function(){return this._letter},getName:function(){return this._name},getTitleEditor:function(){return this._titleEditor},getTitleBackgroundColor:function(){return this._titleEditor?this._titleEditor.getTitleBackgroundColor():this._titleBackgroundColor},prepareLayout:function(t,e){this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,backgroundColor:this._titleBackgroundColor,letter:this._letter});this._titleEditor.prepareLayout(t);this.innerPrepareLayout(t,e);return t},innerPrepareLayout:function(t,e){},prepareExtraControls:function(t){},resetLayout:function(){this._titleEditor.resetLayout();this._titleEditor=null;this.innerResetLayout()},innerResetLayout:function(){},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._config["title"]=this._titleEditor.getTitle();this.innerSaveConfig()},innerSaveConfig:function(){}}}if(typeof BX.CrmNumericWidgetConfigPresetFieldEditor==="undefined"){BX.CrmNumericWidgetConfigPresetFieldEditor=function(){BX.CrmNumericWidgetConfigPresetFieldEditor.superclass.constructor.apply(this);this._entityTypeName="";this._presetEditor=null;this._presetChangeHandler=BX.delegate(this._onPresetChange,this)};BX.extend(BX.CrmNumericWidgetConfigPresetFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerInitialize=function(){this._entityTypeName=this.getSetting("entityTypeName","")};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.getContextId=function(){return this._presetEditor?this._presetEditor.getContextId():BX.CrmWidgetDataContext.undefined};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerPrepareLayout=function(t,e){this._presetEditor=BX.CrmWidgetConfigPresetEditor.create(this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler});this._presetEditor.prepareLayout(t,e)};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerResetLayout=function(){this._presetEditor.resetLayout();this._presetEditor=null};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype.innerSaveConfig=function(){this._presetEditor.saveConfig();this._config=this._presetEditor.getConfig()};BX.CrmNumericWidgetConfigPresetFieldEditor.prototype._onPresetChange=function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}};BX.CrmNumericWidgetConfigPresetFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigPresetFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmNumericWidgetConfigExpressionFieldEditor==="undefined"){BX.CrmNumericWidgetConfigExpressionFieldEditor=function(){BX.CrmNumericWidgetConfigExpressionFieldEditor.superclass.constructor.apply(this);this._source=null;this._operation="";this._leftItem=null;this._rightItem=null;this._leftIcon=null;this._icon=null;this._rightIcon=null;this._operationLegend=null;this._operationIcon=null;this._operationSign=null;this._operationSelector=null;this._operationChangeHandler=BX.delegate(this.onOperationChange,this);this._colorSchemeChangeHandler=BX.delegate(this.onColorSchemeChange,this);this._leftItemColorSchemeChangeHandler=BX.delegate(this.onLeftItemColorSchemeChange,this);this._rightItemColorSchemeChangeHandler=BX.delegate(this.onRightItemColorSchemeChange,this)};BX.extend(BX.CrmNumericWidgetConfigExpressionFieldEditor,BX.CrmNumericWidgetConfigFieldEditor);BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerInitialize=function(){this._source=BX.type.isPlainObject(this._config["dataSource"])?this._config["dataSource"]:{};this._operation=BX.type.isNotEmptyString(this._source["operation"])?this._source["operation"].toUpperCase():BX.CrmWidgetExpressionOperation.diff};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.postInitialize=function(){this._items={};var t=new RegExp("%([^%]+)%");var e=BX.type.isArray(this._source["arguments"])?this._source["arguments"]:[];var i=e.length;var n;if(i>0){if(i<2){throw"CrmNumericWidgetExpressionConfigEditor: Configuration must contain at least two arguments."}for(var r=0;r<2;r++){var s=t.exec(e[r]);if(!s){throw"CrmNumericWidgetExpressionConfigEditor: Could not parse argument."}var o=s[1];n=this._parent.getFieldByName(o);if(!n){throw"CrmNumericWidgetExpressionConfigEditor: Could not find field."}if(r===0){this._leftItem=n}else{this._rightItem=n}}}else{var a=this._parent.getFields();var h=a.length;if(h<2){throw"CrmNumericWidgetExpressionConfigEditor: Parent must contain at least two fields."}for(var l=0;l<2;l++){if(l===0){this._leftItem=a[l]}else{this._rightItem=a[l]}}}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerPrepareLayout=function(t,e){this._operationLegend=BX.create("P",{text:BX.CrmWidgetExpressionOperation.getLegend(this._operation)});t.appendChild(BX.create("DIV",{attrs:{className:"field-container"},children:[this._operationLegend]}));this._icon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this.getTitleBackgroundColor()},text:this._letter});this._leftIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._leftItem.getTitleBackgroundColor()},text:this._leftItem.getLetter()});this._rightIcon=BX.create("SPAN",{attrs:{className:"color-digit"},style:{backgroundColor:this._rightItem.getTitleBackgroundColor()},text:this._rightItem.getLetter()});this._operationSign=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation)}});t.appendChild(BX.create("DIV",{attrs:{className:"subtraction"},children:[BX.create("DIV",{children:[this._icon,BX.create("SPAN",{attrs:{className:"symbol symbol-equally"}}),this._leftIcon,this._operationSign,this._rightIcon]})]}));if(BX.type.isElementNode(t.parentNode)){t.parentNode.appendChild(BX.create("DIV",{attrs:{className:"container-item-equally"},children:[BX.create("SPAN")]}))}var i=this.getTitleEditor();if(i){i.addColorSchemeChangeListener(this._colorSchemeChangeHandler)}var n=this._leftItem.getTitleEditor();if(n){n.addColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}var r=this._rightItem.getTitleEditor();if(r){r.addColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.prepareExtraControls=function(t){var e={type:"action",controls:[]};this._operationIcon=BX.create("SPAN",{attrs:{className:BX.CrmWidgetExpressionOperation.getIconClassName(this._operation)}});e["controls"].push(this._operationIcon);this._operationSelector=BX.CrmWidgetConfigEditor.createSelect({events:{change:this._operationChangeHandler}},BX.CrmWidgetExpressionOperation.prepareListItems());this._operationSelector.value=this._operation;e["controls"].push(BX.create("SPAN",{attrs:{className:"select-container"},children:[this._operationSelector]}));e["controls"].push(BX.create("SPAN",{text:BX.CrmWidgetExpressionOperation.getHint()}));t.push(e)};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerSaveConfig=function(){if(!BX.type.isPlainObject(this._config["dataSource"])){this._config["dataSource"]={}}this._config["dataSource"]["name"]="EXPRESSION";this._config["dataSource"]["operation"]=this._operation;this._config["dataSource"]["arguments"]=["%"+this._leftItem.getName()+"%","%"+this._rightItem.getName()+"%"];if(this._operation!==BX.CrmWidgetExpressionOperation.percent&&(this._leftItem.getContextId()===BX.CrmWidgetDataContext.fund||this._rightItem.getContextId()===BX.CrmWidgetDataContext.fund)){if(!BX.type.isPlainObject(this._config["format"])){this._config["format"]={}}this._config["format"]["isCurrency"]="Y";this._config["format"]["enableDecimals"]="N"}else if(BX.type.isPlainObject(this._config["format"])){delete this._config["format"]["isCurrency"];delete this._config["format"]["enableDecimals"]}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.innerResetLayout=function(){var t=this.getTitleEditor();if(t){t.removeColorSchemeChangeListener(this._colorSchemeChangeHandler)}this._leftIcon=null;var e=this._leftItem?this._leftItem.getTitleEditor():null;if(e){e.removeColorSchemeChangeListener(this._leftItemColorSchemeChangeHandler)}this._rightIcon=null;var i=this._rightItem?this._rightItem.getTitleEditor():null;if(i){i.removeColorSchemeChangeListener(this._rightItemColorSchemeChangeHandler)}this._operationLegend=null;this._operationSign=null;this._operationIcon=null;if(this._operationSelector){BX.unbind(this._presetSelector,"change",this._operationChangeHandler);this._operationSelector=null}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onOperationChange=function(t){this._operation=this._operationSelector.value;this._operationIcon.className=BX.CrmWidgetExpressionOperation.getIconClassName(this._operation);this._operationLegend.innerHTML=BX.util.htmlspecialchars(BX.CrmWidgetExpressionOperation.getLegend(this._operation));this._operationSign.className=BX.CrmWidgetExpressionOperation.getSymbolClassName(this._operation);this._titleEditor.setTitle(BX.CrmWidgetExpressionOperation.getDescription(this._operation))};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onColorSchemeChange=function(){if(this._icon){this._icon.style.backgroundColor=this.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onLeftItemColorSchemeChange=function(){if(this._leftItem&&this._leftIcon){this._leftIcon.style.backgroundColor=this._leftItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.onRightItemColorSchemeChange=function(){if(this._rightItem&&this._rightIcon){this._rightIcon.style.backgroundColor=this._rightItem.getTitleBackgroundColor()}};BX.CrmNumericWidgetConfigExpressionFieldEditor.prototype.getOperation=function(){return this._operation};BX.CrmNumericWidgetConfigExpressionFieldEditor.isExpression=function(t){var e=BX.type.isPlainObject(t["dataSource"])?t["dataSource"]:{};return BX.type.isNotEmptyString(e["name"])&&e["name"].toUpperCase()==="EXPRESSION"};BX.CrmNumericWidgetConfigExpressionFieldEditor.create=function(t,e){var i=new BX.CrmNumericWidgetConfigExpressionFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmGraphWidgetConfigFieldEditor==="undefined"){BX.CrmGraphWidgetConfigFieldEditor=function(){this._id="";this._settings=null;this._name="";this._index=0;this._config=null;this._entityTypeName="";this._contextId=BX.CrmWidgetDataContext.undefined;this._titleBackgroundColor="";this._titleEditor=null;this._presetEditor=null;this._presetChangeHandler=BX.delegate(this.onPresetChange,this);this._titleDeletionHandler=BX.delegate(this.onTitleDeletion,this);this._isNew=false;this._isDeleted=false;this._deletionNotifier=null;this._container=null;this._hasLayout=false};BX.CrmGraphWidgetConfigFieldEditor.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeName=this.getSetting("entityTypeName","");this._index=this.getSetting("index",0);this._contextId=this.getSetting("context",BX.CrmWidgetDataContext.entity);this._config=this.getSetting("config",{});this._name=BX.type.isNotEmptyString(this._config["name"])?this._config["name"]:"c"+(this._index+1);this._titleBackgroundColor=this.getSetting("titleBackgroundColor","");this._isNew=this.getSetting("isNew",false);this._deletionNotifier=BX.CrmNotifier.create(this)},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getIndex:function(){return this._index},getName:function(){return this._name},getContextId:function(){return this._contextId},setContextId:function(t){this._contextId=t;if(this._presetEditor){this._presetEditor.setContextId(t)}},getTitleBackgroundColor:function(){return this._titleBackgroundColor},getTitleEditor:function(){return this._titleEditor},prepareLayout:function(t){if(this._hasLayout){return}this._container=t;this._titleEditor=BX.CrmWidgetConfigTitleEditor.create(this._id,{config:this._config,enableDeletion:true,backgroundColor:this._titleBackgroundColor});this._titleEditor.addDeletionListener(this._titleDeletionHandler);this._titleEditor.prepareLayout(t);this._presetEditor=BX.CrmWidgetConfigPresetEditor.create(this._id,{config:this._config,entityTypeName:this._entityTypeName,presetChange:this._presetChangeHandler,context:this._contextId,enableContextChange:false});this._presetEditor.prepareLayout(t,"wide");this._hasLayout=true;return t},resetLayout:function(){if(!this._hasLayout){return}this._titleEditor.removeDeletionListener(this._titleDeletionHandler);this._titleEditor.resetLayout();this._titleEditor=null;this._presetEditor.resetLayout();this._presetEditor=null;BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},getConfig:function(){return this._config},saveConfig:function(){this._config["name"]=this._name;this._titleEditor.saveConfig();this._presetEditor.saveConfig()},addDeletionListener:function(t){this._deletionNotifier.addListener(t)},removeDeletionListener:function(t){this._deletionNotifier.removeListener(t)},isNew:function(){return this._isNew},isDeleted:function(){return this._isDeleted},onPresetChange:function(t,e){if(e&&BX.type.isNotEmptyString(e["title"])&&this._titleEditor){this._titleEditor.setTitle(e["title"])}},onTitleDeletion:function(t){this._isDeleted=true;this._deletionNotifier.notify()}};BX.CrmGraphWidgetConfigFieldEditor.create=function(t,e){var i=new BX.CrmGraphWidgetConfigFieldEditor;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataPreset==="undefined"){BX.CrmWidgetDataPreset=function(){};BX.CrmWidgetDataPreset.prototype={};BX.CrmWidgetDataPreset.items=[];BX.CrmWidgetDataPreset.notSelected="-";BX.CrmWidgetDataPreset.prepareListItems=function(t,e,i){if(!BX.type.isNotEmptyString(t)){t=""}var n=[{value:"",text:this.notSelected}];for(var r=0;r<this.items.length;r++){var s=this.items[r];var o=BX.type.isNotEmptyString(s["entity"])?s["entity"]:"";var a=BX.type.isNotEmptyString(s["category"])?s["category"]:"";var h=BX.type.isNotEmptyString(s["context"])?s["context"]:"";if(o!==t||a!==e||i!==BX.CrmWidgetDataContext.undefined&&h!==i){continue}var l=BX.type.isNotEmptyString(s["name"])?s["name"]:"";var d=BX.type.isNotEmptyString(s["listTitle"])?s["listTitle"]:"";if(d===""){d=BX.type.isNotEmptyString(s["title"])?s["title"]:""}if(d===""){d=l}n.push({value:l,text:d})}return n};BX.CrmWidgetDataPreset.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var n=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(n===t){return i}}return null}}if(typeof BX.CrmWidgetDataCategory==="undefined"){BX.CrmWidgetDataCategory=function(){};BX.CrmWidgetDataCategory.prototype={};BX.CrmWidgetDataCategory.items=[];BX.CrmWidgetDataCategory.notSelected="-";BX.CrmWidgetDataCategory.getItem=function(t){if(!BX.type.isNotEmptyString(t)){return null}for(var e=0;e<this.items.length;e++){var i=this.items[e];var n=BX.type.isNotEmptyString(i["name"])?i["name"]:"";if(n===t){return i}}return null};BX.CrmWidgetDataCategory.prepareListItems=function(t){if(!BX.type.isNotEmptyString(t)){t=""}var e=[{value:"",text:this.notSelected}];for(var i=0;i<this.items.length;i++){var n=this.items[i];var r=BX.type.isNotEmptyString(n["entity"])?n["entity"]:"";if(r!==t){continue}var s=BX.type.isNotEmptyString(n["name"])?n["name"]:"";var o=BX.type.isNotEmptyString(n["title"])?n["title"]:"";if(o===""){o=s}e.push({value:s,text:o})}return e}}if(typeof BX.CrmWidgetPanelCell==="undefined"){BX.CrmWidgetPanelCell=function(){this._id="";this._settings=null;this._prefix="";this._hasLayout=false;this._panel=null;this._row=null;this._container=null;this._widgets=[]};BX.CrmWidgetPanelCell.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._prefix=this.getSetting("prefix",this._id);this._row=this.getSetting("row");if(!this._row){throw"BX.CrmWidgetPanelCell: Parameter 'row' is not found."}this._panel=this.getSetting("panel");if(!this._panel){this._panel=this._row.getPanel()}this._container=this.getSetting("container",null);var i=this.getSetting("data",[]);var n=this.getSetting("controls",[]);var r=this._row.getHeight();var s=this._panel.getWidgetCount();var o=this._panel.getMaxWidgetCount();for(var a=0;a<i.length;a++){if(o>0&&s>=o){break}var h=n[a];var l=BX.type.isNotEmptyString(h["entityTypeName"])?h["entityTypeName"]:"";if(l===""){l=this._panel.getDefaultEntityTypeName()}var d=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+a,{cell:this,prefix:this._prefix,data:i[a],config:h,entityTypeName:l,heightInPixel:r});this._widgets.push(d);s++}},createWidget:function(t,e){var i=BX.CrmWidgetManager.getCurrent().createWidget(this._prefix+"_"+e,{cell:this,prefix:this._prefix,entityTypeName:BX.type.isNotEmptyString(t["entityTypeName"])?t["entityTypeName"]:"",config:BX.type.isPlainObject(t["config"])?t["config"]:{},data:BX.type.isPlainObject(t["data"])?t["data"]:{},heightInPixel:this._row.getHeight()});this.addWidget(i,e);return i},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRow:function(){return this._row},getPanel:function(){return this._panel},getContainer:function(){return this._container},getIndex:function(){return this._row.getCellIndex(this)},getConfig:function(){var t={controls:[]};for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];t["controls"].push(i.getConfig())}if(t["controls"].length==0){t["isEmpty"]="Y"}return t},getWidgets:function(){return this._widgets},getWidgetCount:function(){return this._widgets.length},getWidgetTotalHeight:function(){var t=0;for(var e=0;e<this._widgets.length;e++){t+=this._widgets[e].getHeight()}return t},getWidgetById:function(t){for(var e=0;e<this._widgets.length;e++){var i=this._widgets[e];if(i.getId()===t){return i}}return null},getWidgetIndex:function(t){for(var e=0;e<this._widgets.length;e++){if(t===this._widgets[e]){return e}}return-1},getNextWidget:function(t){var e=this._widgets.length-1;for(var i=0;i<e;i++){if(t===this._widgets[i]){return this._widgets[i+1]}}return null},addWidget:function(t,e){if(e<this._widgets.length){this._widgets.splice(e,0,t)}else{this._widgets.push(t)}t.setContainer(this._container)},removeWidget:function(t){var e=-1;for(var i=0;i<this._widgets.length;i++){if(t===this._widgets[i]){e=i;break}}if(e>=0){this._widgets.splice(e,1);t.setContainer(null)}},isEmpty:function(){return this._widgets.length===0},isThin:function(){return this._row.getHeight()-this.getWidgetTotalHeight()>0},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-container"}});if(this._row.getCellCount()>1){BX.addClass(this._container,this.getIndex()===0?"crm-widget-left":"crm-widget-right")}this._row.getContainer().appendChild(this._container);for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.setContainer(this._container);e.layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._widgets.length;t++){var e=this._widgets[t];e.clearLayout()}BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},invalidate:function(){for(var t=0;t<this._widgets.length;t++){this._widgets[t].invalidate()}}};BX.CrmWidgetPanelCell.getItemWidgetCount=function(t){return t?t.getWidgetCount():0};BX.CrmWidgetPanelCell.create=function(t,e){
var i=new BX.CrmWidgetPanelCell;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelRow==="undefined"){BX.CrmWidgetPanelRow=function(){this._id="";this._settings=null;this._panel=null;this._prefix="";this._height=0;this._hasLayout=false;this._container=null;this._index=-1;this._cells=[]};BX.CrmWidgetPanelRow.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._panel=this.getSetting("panel");if(!this._panel){throw"BX.CrmWidgetPanelRow: Parameter 'panel' is not found."}this._prefix=this.getSetting("prefix",this._id);this._height=parseInt(this.getSetting("height",BX.CrmWidgetLayoutHeight.full));var i=this.getSetting("cells",[]);for(var n=0;n<i.length;n++){var r=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(n+1),{row:this,controls:i[n]["controls"],data:i[n]["data"]});this._cells.push(r)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getPanel:function(){return this._panel},getContainer:function(){return this._container},getCells:function(){return this._cells},getCellCount:function(){return this._cells.length},getMaxCellHeight:function(){var t=0;for(var e=0;e<this._cells.length;e++){var i=this._cells[e].getWidgetTotalHeight();if(i>t){t=i}}return t},getHeight:function(){return this._height},setHeight:function(t){this._height=t;if(this._container){this._container.style.height=this._height+"px"}},getIndex:function(){return this._panel.getRowIndex(this)},getConfig:function(){var t={cells:[]};for(var e=0;e<this._cells.length;e++){var i=this._cells[e];t["cells"].push(i.getConfig())}if(this._height>0){t["height"]=this._height}return t},getCellIndex:function(t){for(var e=0;e<this._cells.length;e++){if(this._cells[e]===t){return e}}return-1},getCellByIndex:function(t){return this._cells.length>t?this._cells[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._cells.length;e++){var i=this._cells[e];if(i.isThin()){t.push(i)}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._cells.length;i++){e=this._cells[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._cells.length;e++){t+=this._cells[e].getWidgetCount()}return t},isEmpty:function(){for(var t=0;t<this._cells.length;t++){if(!this._cells[t].isEmpty()){return false}}return true},ensureCellCreated:function(t,e){if(t<0){return}e=!!e;for(var i=0;i<=t;i++){if(this._cells.length<=i){var n=BX.CrmWidgetPanelCell.create(this._prefix+"_"+(i+1),{row:this});this._cells.push(n);if(e){n.layout()}}}},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{id:this._prefix+"_container",className:"crm-widget-row"}});this._container.style.height=this._height+"px";var t=this.getIndex();var e=this._panel.getContainer();if(t<0||t>e.children.length){t=e.children.length}if(t===e.children.length){e.appendChild(this._container)}else{e.insertBefore(this._container,e.children[t])}for(var i=0;i<this._cells.length;i++){this._cells[i].layout()}this._hasLayout=true},clearLayout:function(){if(!this._hasLayout){return}for(var t=0;t<this._cells.length;t++){var e=this._cells[t];e.clearLayout()}if(this._container){BX.cleanNode(this._container,true);this._container=null}this._hasLayout=false},invalidate:function(){for(var t=0;t<this._cells.length;t++){this._cells[t].invalidate()}}};BX.CrmWidgetPanelRow.create=function(t,e){var i=new BX.CrmWidgetPanelRow;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanel==="undefined"){BX.CrmWidgetPanel=function(){this._id="";this._settings=null;this._defaultEntityTypeName="";this._entityTypeNames=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._prefix="";this._container=null;this._settingButton=null;this._rows=[];this._dragDropController=null;this._saveConfigCallback=null;this._isSettingMenuShown=false;this._settingMenuId="";this._settingMenu=null;this._settingMenuHandler=BX.delegate(this.onSettingMenuItemClick,this);this._settingButtonClickHandler=BX.delegate(this.onSettingButtonClick,this);this._dynamicRowKeys={};this._isAjaxMode=false;this._isDemoMode=false;this._demoModeInfoContainer=null;this._disableDemoModeButton=null;this._demoModeInfoCloseButton=null;this._disableDemoButtonClickHandler=BX.delegate(this.onDisableDemoButtonClick,this);this._demoModeInfoCloseButtonClickHandler=BX.delegate(this.onDemoInfoCloseButtonClick,this);this._typeSelector=null;this._layoutTypeSelector=null;this._maxGraphCount=0;this._maxWidgetCount=0};BX.CrmWidgetPanel.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypes",[]);this._defaultEntityTypeName=this.getSetting("defaultEntityType","");if(this._defaultEntityTypeName===""&&this._entityTypeNames.length>0){this._defaultEntityTypeName=this._entityTypeNames[0]}this._isAjaxMode=this.getSetting("isAjaxMode",false);this._prefix=this.getSetting("prefix",this._id);var i=this.getSetting("containerId");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'containerId' is not found."}this._container=BX(i);if(!this._container){throw"BX.CrmWidgetPanel: Container is not found."}this._layoutType=this.getSetting("layout",BX.CrmWidgetLayout.l50r50);this.processLayoutTypeChange();this._maxGraphCount=parseInt(this.getSetting("maxGraphCount",0));this._maxWidgetCount=parseInt(this.getSetting("maxWidgetCount",0));var n=this.getSetting("rows");if(BX.type.isArray(n)){for(var r=0;r<n.length;r++){var s=n[r];s["panel"]=this;var o=BX.CrmWidgetPanelRow.create(this._prefix+"_"+(r+1),s);this._rows.push(o)}}this._settingButton=BX(this.getSetting("settingButtonId"));if(this._settingButton){BX.bind(this._settingButton,"click",this._settingButtonClickHandler)}this._isDemoMode=this.getSetting("isDemoMode");if(this._isDemoMode){this._demoModeInfoContainer=BX(this.getSetting("demoModeInfoContainerId"));this._disableDemoModeButton=BX(this.getSetting("disableDemoModeButtonId"));if(this._disableDemoModeButton){BX.bind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler)}this._demoModeInfoCloseButton=BX(this.getSetting("demoModeInfoCloseButtonId"));if(this._demoModeInfoCloseButton){BX.bind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler)}}BX.onCustomEvent(window,"CrmWidgetPanelCreated",[this])},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getMessage:function(t){var e=BX.CrmWidgetPanel.messages;return e.hasOwnProperty(t)?e[t]:t},getContainer:function(){return this._container},getDefaultEntityTypeName:function(){return this._defaultEntityTypeName},getEntityTypeNames:function(){return this._entityTypeNames},getLayoutType:function(){return this._layoutType},setLayoutType:function(t){if(this._layoutType===t){return}this._layoutType=t;this.processLayoutTypeChange();this.invalidate();BX.showWait();BX.ajax.post(this.getSetting("serviceUrl",""),{guid:this._id,action:"savelayout",layout:t},BX.delegate(this.onAfterConfigSave,this))},getRows:function(){return this._rows},getRowCount:function(){return this._rows.length},getRowIndex:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){return e}}return-1},getRowById:function(t){for(var e=0;e<this._rows.length;e++){var i=this._rows[e];if(i.getId()===t){return i}}return null},getRowByIndex:function(t){return this._rows.length>t?this._rows[t]:null},getThinCells:function(){var t=[];for(var e=0;e<this._rows.length;e++){var i=this._rows[e].getThinCells();for(var n=0;n<i.length;n++){t.push(i[n])}}return t},getWidgetById:function(t){var e=null;for(var i=0;i<this._rows.length;i++){e=this._rows[i].getWidgetById(t);if(e){break}}return e},getWidgetCount:function(){var t=0;for(var e=0;e<this._rows.length;e++){t+=this._rows[e].getWidgetCount()}return t},getCurrencyFormat:function(){return this.getSetting("currencyFormat",null)},getMaxGraphCount:function(){return this._maxGraphCount},getMaxWidgetCount:function(){return this._maxWidgetCount},openTypeSelector:function(){if(this._layoutTypeSelector&&this._layoutTypeSelector.isDialogOpened()){this._layoutTypeSelector.closeDialog()}if(!this._typeSelector){this._typeSelector=BX.CrmWidgetTypeSelector.create(this._id+"_widget_type_selector",{entityTypeNames:[this._defaultEntityTypeName],callback:BX.delegate(this.onConfiguratorAction,this)})}this._typeSelector.openDialog()},openLayoutTypeSelector:function(){if(this._typeSelector&&this._typeSelector.isDialogOpened()){this._typeSelector.closeDialog()}if(!this._layoutTypeSelector){this._layoutTypeSelector=BX.CrmWidgetPanelLayoutTypeSelector.create(this._id+"_layout_type_selector",{layoutType:this._layoutType,callback:BX.delegate(this.onConfiguratorAction,this)})}this._layoutTypeSelector.openDialog()},onConfiguratorAction:function(t,e){if(t!==this._typeSelector&&t!==this._layoutTypeSelector){return}t.closeDialog();var i=BX.type.isNotEmptyString(e["action"])?e["action"]:"";var n=BX.type.isPlainObject(e["data"])?e["data"]:{};if(i==="addItem"&&BX.type.isPlainObject(n["params"])){this.addWidget(n["params"])}else if(i="changeLayout"&&BX.type.isNotEmptyString(n["layoutType"])){this.setLayoutType(n["layoutType"])}},addWidget:function(t){var e=this.getWidgetCount();if(this._maxWidgetCount>0&&e>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount));return}var i=this.createRow({index:0,height:BX.type.isNumber(t["rowHeight"])?t["rowHeight"]:BX.CrmWidgetLayoutHeight.full,cellCount:1});var n=i.getCellByIndex(0).createWidget(t,0);n.layout();this._dragDropController.registerRow(i);this.saveConfig(function(){n.openConfigDialog()})},createRow:function(t){var e=BX.util.getRandomString(6).toLowerCase();while(this._dynamicRowKeys.hasOwnProperty(e)){e=BX.util.getRandomString(8).toLowerCase()}var i=this._prefix+"_"+e;this._dynamicRowKeys[e]=i;var n=t["index"];var r=t["height"];var s=t["cellCount"];var o=BX.CrmWidgetPanelRow.create(i,{panel:this,height:r,dynamicKey:e});for(var a=0;a<s;a++){o.ensureCellCreated(a,false)}this._rows.splice(n,0,o);o.layout();return o},removeRow:function(t){for(var e=0;e<this._rows.length;e++){if(this._rows[e]===t){var i=t.getSetting("dynamicKey","");if(i!==""){delete this._dynamicRowKeys[i]}t.clearLayout();this._rows.splice(e,1);return}}},moveWidget:function(t,e,i,n){t.clearLayout();t.undock();e.ensureCellCreated(i);var r=e.getCellByIndex(i);t.dock(r,n);t.layout()},processWidgetRemoval:function(t){var e=t.getRow();if(!e){return}if(!t.remove()){return}this._dragDropController.processRowChange(e);this.saveConfig()},processWidgetRefresh:function(t){this._dragDropController.processWidgetChange(t)},processLayoutTypeChange:function(){var t="crm-widget";if(this._layoutType===BX.CrmWidgetLayout.l70r30){t="crm-widget-70-30"}else if(this._layoutType===BX.CrmWidgetLayout.l50r50){t="crm-widget-50-50"}else if(this._layoutType===BX.CrmWidgetLayout.l30r70){t="crm-widget-30-70"}this._container.className=t},layout:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].layout()}this._dragDropController=BX.CrmWidgetDragDropController.create(this._id,{panel:this,wrapper:this._container,rows:this._rows})},saveConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"saveconfig",rows:[]};for(var n=0;n<this._rows.length;n++){i["rows"].push(this._rows[n].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},resetConfig:function(t){var e=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(e)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var i={guid:this._id,action:"resetrows",rows:[]};for(var n=0;n<this._rows.length;n++){i["rows"].push(this._rows[n].getConfig())}if(BX.type.isFunction(t)){this._saveConfigCallback=t}BX.showWait();BX.ajax.post(e,i,BX.delegate(this.onAfterConfigSave,this))},enableDemoMode:function(t,e){t=!!t;window.setTimeout(function(){window.location.reload()},200);var i=this.getSetting("serviceUrl","");if(!BX.type.isNotEmptyString(i)){throw"BX.CrmWidgetPanel: Parameter 'serviceUrl' is not found."}var n={guid:this._id,action:"enabledemo",enable:t?"Y":"N"};if(BX.type.isFunction(e)){this._saveConfigCallback=e}BX.showWait();BX.ajax.post(i,n,BX.delegate(this.onAfterConfigSave,this))},isAjaxMode:function(){return this._isAjaxMode},invalidate:function(){for(var t=0;t<this._rows.length;t++){this._rows[t].invalidate()}},onAfterConfigSave:function(){BX.closeWait();if(this._saveConfigCallback){this._saveConfigCallback();this._saveConfigCallback=null}},onSettingButtonClick:function(){if(!this._isSettingMenuShown){this.openSettingMenu()}else{this.closeSettingMenu()}},openSettingMenu:function(){if(this._isSettingMenuShown){return}this._settingMenuId=this._id+"_menu";if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}var t=[];if(!this._isDemoMode){t.push({id:"add",text:this.getMessage("menuItemAdd"),onclick:this._settingMenuHandler})}t.push({id:"layout",text:this.getMessage("menuChangeLayout"),onclick:this._settingMenuHandler});t.push({id:"reset",text:this.getMessage("menuItemReset"),onclick:this._settingMenuHandler});if(!this._isDemoMode){t.push({id:"enabledemomode",text:this.getMessage("menuItemEnableDemoMode"),onclick:this._settingMenuHandler})}this._settingMenu=BX.PopupMenu.create(this._settingMenuId,this._settingButton,t,{autoHide:true,offsetLeft:-21,offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onSettingMenuClose,this)}});this._settingMenu.popupWindow.show();this._isSettingMenuShown=true},closeSettingMenu:function(){if(this._settingMenu&&this._settingMenu.popupWindow){this._settingMenu.popupWindow.close()}},onSettingMenuClose:function(){this._settingMenu=null;if(typeof BX.PopupMenu.Data[this._settingMenuId]!=="undefined"){BX.PopupMenu.Data[this._settingMenuId].popupWindow.destroy();delete BX.PopupMenu.Data[this._settingMenuId]}this._isSettingMenuShown=false},onSettingMenuItemClick:function(t,e){if(e.id==="add"){var i=this.getWidgetCount();if(this._maxWidgetCount>0&&i>=this._maxWidgetCount){alert(this.getMessage("maxWidgetError").replace(/#MAX_WIDGET_COUNT#/gi,this._maxWidgetCount))}else{this.openTypeSelector()}}else if(e.id==="layout"){this.openLayoutTypeSelector()}else if(e.id==="reset"){this.resetConfig(function(){window.location.reload()})}else if(e.id==="enabledemomode"){this.enableDemoMode(true,function(){window.location.reload()})}this.closeSettingMenu()},onDisableDemoButtonClick:function(t){this.enableDemoMode(false,function(){window.location.reload()})},onDemoInfoCloseButtonClick:function(){if(this._disableDemoModeButton){BX.unbind(this._disableDemoModeButton,"click",this._disableDemoButtonClickHandler);this._disableDemoModeButton=null}if(this._demoModeInfoCloseButton){BX.unbind(this._demoModeInfoCloseButton,"click",this._demoModeInfoCloseButtonClickHandler);this._demoModeInfoCloseButton=null}BX.cleanNode(this._demoModeInfoContainer,true);this._demoModeInfoContainer=null}};if(typeof BX.CrmWidgetPanel.messages==="undefined"){BX.CrmWidgetPanel.messages={}}BX.CrmWidgetPanel.isAjaxMode=false;BX.CrmWidgetPanel.current=null;BX.CrmWidgetPanel.create=function(t,e){var i=new BX.CrmWidgetPanel;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetLayout==="undefined"){BX.CrmWidgetLayout={undifined:"",l70r30:"L70R30",l50r50:"L50R50",l30r70:"L30R70",getAll:function(){return[this.l70r30,this.l50r50,this.l30r70]}}}if(typeof BX.CrmWidgetLayoutHeight==="undefined"){BX.CrmWidgetLayoutHeight={undifined:0,full:380,half:180}}if(typeof BX.CrmWidgetExpressionOperation==="undefined"){BX.CrmWidgetExpressionOperation={undefined:"",sum:"SUM",diff:"DIFF",percent:"PC",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t},getMessage:function(t){var e=BX.CrmWidgetExpressionOperation.messages;return e.hasOwnProperty(t)?e[t]:t},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},getLegend:function(t){t=t.toUpperCase();if(t===this.diff){return this.getMessage("diffLegend")}else if(t===this.sum){return this.getMessage("sumLegend")}else if(t===this.percent){return this.getMessage("percentLegend")}return""},getHint:function(){return this.getMessage("hint")},getSign:function(t){t=t.toUpperCase();if(t===this.diff){return"&#8722;"}else if(t===this.sum){return"&#43;"}else if(t===this.percent){return"&#37;"}return""},getIconClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"action-icon action-icon-minus"}else if(t===this.sum){return"action-icon action-icon-plus"}else if(t===this.percent){return"action-icon action-icon-persent"}return"action-icon"},getSymbolClassName:function(t){t=t.toUpperCase();if(t===this.diff){return"symbol symbol-minus"}else if(t===this.sum){return"symbol symbol-plus"}else if(t===this.percent){return"symbol symbol-persent"}return""}};if(typeof BX.CrmWidgetExpressionOperation.messages==="undefined"){BX.CrmWidgetExpressionOperation.messages={}}}if(typeof BX.CrmWidgetConfigControlMode==="undefined"){BX.CrmWidgetConfigControlMode={undifined:0,view:1,edit:2}}if(typeof BX.CrmWidgetFilterPeriod==="undefined"){BX.CrmWidgetFilterPeriod={undefined:"",year:"Y",quarter:"Q",month:"M",currentMonth:"M0",currentQuarter:"Q0",lastDays90:"D90",lastDays60:"D60",lastDays30:"D30",lastDays7:"D7",descriptions:{},getDescription:function(t){return this.descriptions.hasOwnProperty(t)?this.descriptions[t]:""},prepareListItems:function(t,e){if(!t){t={}}e=!!e;var i=[];for(var n in this.descriptions){if(!this.descriptions.hasOwnProperty(n)){continue}if(n===BX.CrmWidgetFilterPeriod.undefined&&e){continue}var r=t.hasOwnProperty(n)?t[n]:this.descriptions[n];i.push({value:n,text:r})}return i}}}if(typeof BX.CrmWidgetColorScheme==="undefined"){BX.CrmWidgetColorScheme={undifined:"",red:"red",green:"green",blue:"blue",cyan:"cyan",yellow:"yellow",descriptions:{},infos:{red:{color:"#f02f2f"},green:{color:"#05d215"},blue:{color:"#4fc3f7"},cyan:{color:"#50c5d3"},yellow:{color:"#f7d622"}},getInfo:function(t){return typeof this.infos[t]!=="undefined"?this.infos[t]:null},prepareMenuItems:function(t){var e=[];for(var i in this.infos){if(!this.infos.hasOwnProperty(i)){continue}var n=this.infos[i]["color"];var r=this.descriptions[i];e.push({id:i,text:'<span class="color-item"><span style="background: '+n+';" class="color"></span>'+r+"</span>",onclick:t})}return e}}}if(typeof BX.CrmWidgetDataGrouping==="undefined"){BX.CrmWidgetDataGrouping={undefined:"",date:"DATE",user:"USER",descriptions:{},prepareListItems:function(t){t=!!t;var e=[];for(var i in this.descriptions){if(!this.descriptions.hasOwnProperty(i)){continue}if(i!==this.undefined||t){e.push({value:i,text:this.descriptions[i]})}}return e}}}if(typeof BX.CrmWidgetDataContext==="undefined"){BX.CrmWidgetDataContext={undefined:"",entity:"E",fund:"F",percent:"P",descriptions:{},prepareListItems:function(){var t=[];for(var e in this.descriptions){if(!this.descriptions.hasOwnProperty(e)){continue}t.push({value:e,text:this.descriptions[e]})}return t}}}if(typeof BX.CrmPhaseSemantics==="undefined"){BX.CrmPhaseSemantics={undefined:"",process:"P",success:"S",failure:"F",descriptions:{},detailedInfos:{},getCaption:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["caption"])?this.detailedInfos[t]["caption"]:""},getSelectorTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["selectorTitle"])?this.detailedInfos[t]["selectorTitle"]:""},getGroupTitle:function(t){return BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isNotEmptyString(this.detailedInfos[t]["groupTitle"])?this.detailedInfos[t]["groupTitle"]:""},prepareListItems:function(t){var e=BX.type.isNotEmptyString(t)&&BX.type.isPlainObject(this.detailedInfos[t])&&BX.type.isPlainObject(this.detailedInfos[t]["descriptions"])?this.detailedInfos[t]["descriptions"]:this.descriptions;var i=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}i.push({value:n,text:e[n]})}return i}}}if(typeof BX.CrmWidgetManager==="undefined"){BX.CrmWidgetManager=function(){this._requestQueue=null;this._isRequestRunning=false};BX.CrmWidgetManager.prototype={initialize:function(){this._requestQueue=[]},createWidget:function(t,e){e=e?e:{};var i=e.hasOwnProperty("config")?e["config"]:{};var n=i.hasOwnProperty("typeName")?i["typeName"]:"";if(n===""){throw"CrmWidgetManager: The type name is not found."}if(n==="funnel"){return BX.CrmFunnelWidget.create(t,e)}else if(n==="pie"){return BX.CrmPieWidget.create(t,e)}else if(n==="graph"||n==="bar"){return BX.CrmGraphWidget.create(t,e)}else if(n==="number"){return BX.CrmNumericWidget.create(t,e)}else if(n==="rating"){return BX.CrmRatingWidget.create(t,e)}return BX.CrmWidget.create(t,e)},prepareWidgetData:function(t){this.addToQueueItem(t,"PREPARE_DATA",{CONTROL:t.getConfig(),FILTER:BX.CrmWidgetManager.filter});this.processQueue()},addToQueueItem:function(t,e,i){var n=t.getId()+"_"+BX.util.getRandomString(8).toLowerCase();this._requestQueue.push({guid:n,widget:t,action:e,params:i})},getQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]["guid"]===t){return this._requestQueue[e]}}return null},removeQueueItem:function(t){for(var e=0;e<this._requestQueue.length;e++){if(this._requestQueue[e]===t){this._requestQueue.splice(e,1);return true}}return false},processQueue:function(){if(this._isRequestRunning||this._requestQueue.length===0){return}var t=this._requestQueue[0];var e=t["params"];e["GUID"]=t["guid"];this._startRequest(t["action"],e)},_startRequest:function(t,e){if(this._isRequestRunning){return false}var i=BX.CrmWidgetManager.serviceUrl;if(!BX.type.isNotEmptyString(i)){throw"CrmWidgetManager: Could no start request. The fild 'serviceUrl' is not assigned."}this._isRequestRunning=true;BX.showWait();BX.ajax({url:i,method:"POST",dataType:"json",data:{ACTION:t,PARAMS:e},onsuccess:BX.delegate(this._onRequestSuccess,this),onfailure:BX.delegate(this._onRequestFailure,this)});return true},_onRequestSuccess:function(t){this._isRequestRunning=false;BX.closeWait();if(!BX.type.isPlainObject(t["RESULT"])){return}var e=t["RESULT"];var i=BX.type.isNotEmptyString(e["GUID"])?this.getQueueItem(e["GUID"]):null;if(!i){return}if(BX.type.isPlainObject(e["DATA"])){i["widget"].setData(e["DATA"]);i["widget"].refresh()}this.removeQueueItem(i)},_onRequestFailure:function(t){this._isRequestRunning=false;BX.closeWait()}};BX.CrmWidgetManager.serviceUrl="";BX.CrmWidgetManager.current=null;BX.CrmWidgetManager.getCurrent=function(){if(!this.current){this.current=new BX.CrmWidgetManager;this.current.initialize()}return this.current}}if(typeof BX.CrmWidgetDragDropController==="undefined"){BX.CrmWidgetDragDropController=function(){this._id="";this._settings=null;this.panel=null;this.wrapper=null;this.dropZoneListObj={};this.dropZoneList=[];this.dropZoneCounter=0;this.dropZoneActiveClass="crm-widget-catcher-inner-active";this.activeDragRow=null;this.prevEventPosX=0;this.prevEventPosY=0;this.isDropBlockShow=false};BX.CrmWidgetDragDropController.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this.panel=e.panel;var i=e.rows;for(var n=0;n<i.length;n++){var r=i[n];r.getContainer().setAttribute("data-row-id",r.getId())}this.wrapper=e.wrapper;this.ddPlaceBlock=this.createDropZoneBlock();this.crmDnD=BX.DragDrop.create({dragItemClassName:"crm-widget",dropZoneList:this.dropZoneList,dragActiveClass:"crm-widget-drag-active",drag:BX.delegate(this.drag,this),dragStart:BX.delegate(this.dragStart,this),dragDrop:BX.delegate(this.dragDrop,this),dragEnter:BX.delegate(this.dragEnter,this),dragLeave:BX.delegate(this.dragLeave,this),dragEnd:BX.delegate(this.dragEnd,this),sortable:{rootElem:e.wrapper,className:"crm-widget-row",node:this.ddPlaceBlock}});this.initializeCellDropZones()},initializeCellDropZones:function(){var t=this.panel.getThinCells();for(var e=0;e<t.length;e++){var i=t[e];var n=i.getWidgetTotalHeight();if(n>BX.CrmWidgetLayoutHeight.half){continue}var r=i.getRow();var s=n>0?BX.CrmWidgetLayoutHeight.half:r.getHeight();var o=this.createDropZone({parentRowId:r.getId(),parentCellId:i.getId(),height:s,htmlHeight:s,position:r.getCellCount()>1?r.getCellIndex(i)>0?"right":"left":"wide"});o.style.display="none";i.getContainer().appendChild(o)}},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getId:function(){return this._id},getRowInfo:function(t){var e={height:0,node:null,index:0,chartsCount:0};var i=this.panel.getRowById(t);if(i){e.height=i.getHeight();e.node=i.getContainer();e.index=i.getIndex();e.chartsCount=i.getWidgetCount()}return e},getWidgetInfo:function(t){var e={height:0,node:null,parentRowId:"",parentCellId:"",rowIndex:-1,cellIndex:-1,index:-1};var i=this.panel.getWidgetById(t);if(i){var n=i.getCell();var r=n.getRow();e.height=i.getHeight();e.node=i.getWrapper();e.parentRowId=r.getId();e.parentCellId=n.getId();e.rowIndex=r.getIndex();e.cellIndex=n.getIndex();e.index=i.getIndex()}return e},createDropZone:function(t){var e=t.position||null,i=t.parentRowId||null,n=t.parentCellId||null,r=t.height,s=t.htmlHeight;var o="dropZone-"+this.dropZoneCounter;this.dropZoneCounter++;var a=BX.create("div",{props:{className:"crm-widget-catcher-inner"},attrs:{"data-dropZone-id":o},style:{height:s+"px"}});this.dropZoneListObj[o]={id:o,node:a,position:e,parentRowId:i,parentCellId:n,height:r};if(i)this.crmDnD.addCatcher(a);if(e)this.dropZoneList.push(a);return a},createDropZoneBlock:function(){return BX.create("div",{props:{className:"crm-widget-catcher-wrap"},children:[BX.create("div",{props:{className:"crm-widget-catcher crm-widget-left"},children:[this.createDropZone({position:"left",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-right"},children:[this.createDropZone({position:"right",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]}),BX.create("div",{props:{className:"crm-widget-catcher crm-widget-bottom"},children:[this.createDropZone({position:"wide",height:BX.CrmWidgetLayoutHeight.full,htmlHeight:55})]})]})},showDropZone:function(t){for(var e in this.dropZoneListObj){if(t==BX.CrmWidgetLayoutHeight.half&&this.dropZoneListObj[e].height<=BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block";else if(this.dropZoneListObj[e].height==BX.CrmWidgetLayoutHeight.full)this.dropZoneListObj[e].node.style.display="block"}},hideDropZone:function(){for(var t in this.dropZoneListObj){BX.removeClass(this.dropZoneListObj[t].node,this.dropZoneActiveClass);this.dropZoneListObj[t].node.style.display="none"}},showDropBlock:function(t){this.ddPlaceBlock.style.display="block";this.wrapper.insertBefore(this.ddPlaceBlock,t);setTimeout(BX.delegate(function(){this.ddPlaceBlock.style.height=133+"px"},this),50)},hideDropBlock:function(){this.ddPlaceBlock.style.height=0;this.isDropBlockShow=false;setTimeout(BX.delegate(function(){this.wrapper.removeChild(this.ddPlaceBlock)},this),300)},showNewRow:function(t){var e=this.getRowInfo(t);this.wrapper.insertBefore(e.node,this.ddPlaceBlock);e.node.setAttribute("data-row-id",t);e.node.style.opacity=0;e.node.style.height=133+"px";this.ddPlaceBlock.style.display="none";setTimeout(BX.delegate(function(){e.node.style.height=e.height+"px";e.node.style.opacity=1}),50)},getCellDropZone:function(t){for(var e in this.dropZoneListObj){if(!this.dropZoneListObj.hasOwnProperty(e)){continue}var i=this.dropZoneListObj[e];if(i.parentCellId===t){return i}}return null},registerRow:function(t){var e=t.getContainer();e.setAttribute("data-row-id",t.getId());this.crmDnD.addSortableItem(e);var i=t.getCells();for(var n=0;n<i.length;n++){var r=i[n].getWidgets();for(var s=0;s<r.length;s++){this.crmDnD.addDragItem([r[s].getWrapper()])}}this.processRowChange(t)},processWidgetChange:function(t){this.crmDnD.addDragItem([t.getWrapper()])},processRowChange:function(t){if(t.isEmpty()){this.crmDnD.removeSortableItem(t.getContainer());this.panel.removeRow(t);return}var e=0,i=null,n=0,r=0;var s=t.getCells();var o=s.length;for(e=0;e<o;e++){n=s[e].getWidgetTotalHeight();if(r<n){r=n}}var a=t.getHeight();if(a!==r){a=r>BX.CrmWidgetLayoutHeight.half?BX.CrmWidgetLayoutHeight.full:BX.CrmWidgetLayoutHeight.half;t.setHeight(a)}for(e=0;e<o;e++){i=s[e];n=i.getWidgetTotalHeight();var h=this.getCellDropZone(i.getId());var l=a-n>=BX.CrmWidgetLayoutHeight.half;if(!l&&h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}else if(l){var d=n===0?a:BX.CrmWidgetLayoutHeight.half;if(h){delete this.dropZoneListObj[h.id];this.crmDnD.removeCatcher(h.node);BX.cleanNode(h.node,true)}var g=this.createDropZone({parentRowId:t.getId(),parentCellId:i.getId(),height:d,htmlHeight:d,position:o>1?i.getIndex()>0?"right":"left":"wide"});g.style.display="none";i.getContainer().appendChild(g)}}},dragStart:function(t){var e=t.dragElement.getAttribute("data-widget-id");var i=this.getWidgetInfo(e);var n=i.parentRowId;var r=this.getRowInfo(n).node;var s=i.height;this.showDropZone(s);this.activeDragRow=r;this.prevEventPosY=t.event.clientY;this.prevEventPosX=t.event.clientX},drag:function(t,e,i){this.dragClientY=i.clientFFY||i.clientY;if(this.dragClientY>this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow.nextSibling);this.isDropBlockShow=true}else if(this.dragClientY<this.prevEventPosY&&!this.isDropBlockShow){this.showDropBlock(this.activeDragRow);this.isDropBlockShow=true}this.prevEventPosY=this.dragClientY},dragDrop:function(t,e){var i=t.getAttribute("data-dropZone-id");var n=this.dropZoneListObj[i];var r=e.getAttribute("data-widget-id");var s=this.panel.getWidgetById(r);var o=null;var a=0;var h=0;if(n.parentRowId){o=this.panel.getRowById(n.parentRowId);a=n.position==="right"?1:0;h=BX.CrmWidgetPanelCell.getItemWidgetCount(o.getCellByIndex(a))}else if(n.position){var l=this.panel.getRowCount();var d=BX.findNextSibling(this.ddPlaceBlock,{tagName:"DIV",className:"crm-widget-row"});if(d){l=this.panel.getRowById(d.getAttribute("data-row-id")).getIndex()}o=this.panel.createRow({index:l,height:s.getHeight(),cellCount:n.position==="wide"?1:2});a=n.position==="right"?1:0;h=0;var g=o.getId();this.crmDnD.addSortableItem(o.getContainer());this.showNewRow(g)}var c=s.getRow();this.panel.moveWidget(s,o,a,h);this.crmDnD.addDragItem([s.getWrapper()]);o=s.getRow();this.processRowChange(c);if(o!==c){this.processRowChange(o)}this.panel.saveConfig()},dragEnter:function(t){BX.addClass(t,this.dropZoneActiveClass)},dragLeave:function(t){BX.removeClass(t,this.dropZoneActiveClass)},dragEnd:function(){this.hideDropZone();this.hideDropBlock();this.isDropBlockShow=false}};BX.CrmWidgetDragDropController.items={};BX.CrmWidgetDragDropController.create=function(t,e){var i=new BX.CrmWidgetDragDropController;i.initialize(t,e);this.items[i.getId()]=i;return i}}if(typeof BX.CrmWidgetTypeSelector==="undefined"){BX.CrmWidgetTypeSelector=function(){this._id="";this._settings=null;this._currentEntityTypeName="";this._entityTypeNames=null;this._tabs=null;this._widgetTypeItems=null;this._widgetTypeContainer=null;this._tabSelectionHandler=BX.delegate(this.onTabSelection,this);this._widgetTypeSelectionHandler=BX.delegate(this.onWidgetTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._entityTypeNames=this.getSetting("entityTypeNames",[]);this._currentEntityTypeName=this._entityTypeNames.length>0?this._entityTypeNames[0]:"";

this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},isEntityTypeEnabled:function(t){for(var e=0;e<this._entityTypeNames.length;e++){if(this._entityTypeNames[e]===t){return true}}return false},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:{content:this.prepareDialogTitle()},content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogTitle:function(){return BX.create("SPAN",{attrs:{className:"bx-lists-dialog-title"},text:this.getMessage("dialogTitle")})},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-sidebar"}});t.appendChild(e);this._tabs=[];for(var i=0;i<BX.CrmWidgetTypeSelector.entityTypeInfos.length;i++){var n=BX.CrmWidgetTypeSelector.entityTypeInfos[i];var r=BX.type.isNotEmptyString(n["name"])?n["name"]:"";if(r===""){continue}var s=BX.type.isNotEmptyString(n["description"])?n["description"]:"";if(s===""){s=r}var o=this.isEntityTypeEnabled(r);var a=BX.CrmWidgetPanelConfiguratorTab.create(r,{title:s,isActive:o,className:o?"sidebar-tab-active":"sidebar-tab-disabled",container:e,configurator:this});this._tabs.push(a);a.addSelectionListener(this._tabSelectionHandler);a.layout()}var h=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(h);this._widgetTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});h.appendChild(this._widgetTypeContainer);this._widgetTypeItems=[];for(var l=0;l<BX.CrmWidgetTypeSelector.infos.length;l++){var d=BX.CrmWidgetTypeSelector.infos[l];var g=BX.CrmWidgetTypeSelectorItem.create(d["name"],{info:d,wrapper:this._widgetTypeContainer,configurator:this});this._widgetTypeItems.push(g);g.layout();g.addSelectionListener(this._widgetTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(BX.type.isArray(this._tabs)){for(var t=0;t<this._tabs.length;t++){var e=this._tabs[t];e.removeSelectionListener(this._tabSelectionHandler);e.cleanLayout()}}this._tabs=null;if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onTabSelection:function(t){var e=t.getId();if(e==="LAYOUT"){this._widgetTypeContainer.style.display="none";this._layoutTypeContainer.style.display=""}else{this._layoutTypeContainer.style.display="none";this._widgetTypeContainer.style.display="";this._currentEntityTypeName=e}},onWidgetTypeSelection:function(t){if(!this._callback){return}var e=t.getInfo();var i=BX.clone(e["params"]);i["entityTypeName"]=this._currentEntityTypeName;this._callback(this,{action:"addItem",data:{params:i}})}};if(typeof BX.CrmWidgetTypeSelector.messages==="undefined"){BX.CrmWidgetTypeSelector.messages={}}if(typeof BX.CrmWidgetTypeSelector.entityTypeInfos==="undefined"){BX.CrmWidgetTypeSelector.entityTypeInfos=[]}if(typeof BX.CrmWidgetTypeSelector.infos==="undefined"){BX.CrmWidgetTypeSelector.infos=[]}BX.CrmWidgetTypeSelector.create=function(t,e){var i=new BX.CrmWidgetTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetTypeSelectorItem==="undefined"){BX.CrmWidgetTypeSelectorItem=function(){this._id="";this._settings=null;this._info=null;this._configurator=null;this._wrapper=null;this._container=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetTypeSelectorItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._info=this.getSetting("info");if(!this._info){throw"CrmWidgetTypeSelectorItem: The 'info' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetTypeSelectorItem: The 'configurator' parameter is not found."}this._wrapper=this.getSetting("wrapper");if(!this._wrapper){throw"CrmWidgetTypeSelectorItem: The 'wrapper' parameter is not found."}this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getInfo:function(){return this._info},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._container=BX.create("DIV",{attrs:{className:"view-report-container"},children:[BX.create("DIV",{attrs:{className:"view-report"},children:[BX.create("IMG",{props:{src:this._info["logo"]}})]}),BX.create("DIV",{attrs:{className:"view-report-title"},text:this._info["title"]})]});BX.bind(this._container,"click",this._clickHandler);this._wrapper.appendChild(this._container);this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._container,"click",this._clickHandler);BX.cleanNode(this._container,true);this._container=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetTypeSelectorItem.create=function(t,e){var i=new BX.CrmWidgetTypeSelectorItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeSelector==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector=function(){this._id="";this._settings=null;this._layoutTypeItems=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._layoutTypeContainer=null;this._layoutTypeSelectionHandler=BX.delegate(this.onLayoutTypeSelection,this);this._callback=null;this._dlg=null};BX.CrmWidgetPanelLayoutTypeSelector.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType",BX.CrmWidgetLayout.l50r50);this._callback=this.getSetting("callback");if(!BX.type.isFunction(this._callback)){this._callback=null}},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getMessage:function(t){var e=BX.CrmWidgetPanelLayoutTypeSelector.messages;return e.hasOwnProperty(t)?e[t]:t},openDialog:function(){if(this._dlg){return}var t=this._id;this._dlg=new BX.PopupWindow(t,null,{autoHide:false,draggable:true,bindOptions:{forceBindPosition:false},closeByEsc:false,closeIcon:{top:"10px",right:"15px"},zIndex:0,titleBar:{content:this.prepareDialogTitle()},content:this.prepareDialogContent(),buttons:[new BX.PopupWindowButtonLink({text:this.getMessage("dialogCancelButton"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(this.onDialogCancelButtonClick,this)}})],events:{onPopupShow:BX.delegate(this.onDialogShow,this),onPopupClose:BX.delegate(this.onDialogClose,this),onPopupDestroy:BX.delegate(this.onDialogDestroy,this)}});this._dlg.show()},closeDialog:function(){if(this._dlg){this._dlg.close()}},isDialogOpened:function(){return this._dlg&&this._dlg.isShown()},prepareDialogTitle:function(){return BX.create("SPAN",{attrs:{className:"bx-lists-dialog-title"},text:this.getMessage("dialogTitle")})},prepareDialogContent:function(){var t=BX.create("DIV",{attrs:{className:"view-report-wrapper-container"}});var e=BX.create("DIV",{attrs:{className:"view-report-wrapper view-report-wrapper-popup"}});t.appendChild(e);this._layoutTypeContainer=BX.create("DIV",{attrs:{className:"view-report-wrapper-inner"}});e.appendChild(this._layoutTypeContainer);this._layoutTypeItems=[];var i=BX.CrmWidgetLayout.getAll();for(var n=0;n<i.length;n++){var r=i[n];var s=BX.CrmWidgetPanelLayoutTypeItem.create(r,{layoutType:r,isActive:this._layoutType===r,container:this._layoutTypeContainer,configurator:this});this._layoutTypeItems.push(s);s.layout();s.addSelectionListener(this._layoutTypeSelectionHandler)}return t},onDialogShow:function(){},onDialogClose:function(){if(this._dlg){this._dlg.destroy()}},onDialogDestroy:function(){this._dlg=null},onDialogCancelButtonClick:function(){this.closeDialog()},onLayoutTypeSelection:function(t){if(!this._callback){return}this._layoutType=t.getLayoutType();this._callback(this,{action:"changeLayout",data:{layoutType:this._layoutType}})}};if(typeof BX.CrmWidgetPanelLayoutTypeSelector.messages==="undefined"){BX.CrmWidgetPanelLayoutTypeSelector.messages={}}BX.CrmWidgetPanelLayoutTypeSelector.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeSelector;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelLayoutTypeItem==="undefined"){BX.CrmWidgetPanelLayoutTypeItem=function(){this._id="";this._settings=null;this._layoutType=BX.CrmWidgetLayout.undifined;this._container=null;this._configurator=null;this._isActive=false;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelLayoutTypeItem.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._layoutType=this.getSetting("layoutType");if(this._layoutType===BX.CrmWidgetLayout.undifined){throw"CrmWidgetPanelLayoutTypeItem: The 'layoutType' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelLayoutTypeItem: The 'container' parameter is not found."}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelLayoutTypeItem: The 'configurator' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getLayoutType:function(){return this._layoutType},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}var t="crm-widget-template";if(this._isActive){t+=" crm-widget-template-active"}this._wrapper=BX.create("DIV",{attrs:{className:t}});this._container.appendChild(this._wrapper);var e=5;var i=5;if(this._layoutType===BX.CrmWidgetLayout.l30r70){e=3;i=7}else if(this._layoutType===BX.CrmWidgetLayout.l70r30){e=7;i=3}this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(10));this._wrapper.appendChild(BX.create("BR"));this._wrapper.appendChild(this.prepareTileLayout(e));this._wrapper.appendChild(this.prepareTileLayout(i));BX.bind(this._wrapper,"click",this._clickHandler);this._hasLayout=true},prepareTileLayout:function(t){var e="crm-widget-template-item";if(t<10){e+=" template-item-"+t.toString()}return BX.create("DIV",{attrs:{className:e},text:(t*10).toString()+"%"})},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._wrapper,"click",this._clickHandler);BX.cleanNode(this._wrapper,true);this._wrapper=null;this._hasLayout=false},onClick:function(t){this._selectionNotifier.notify();return BX.PreventDefault(t)}};BX.CrmWidgetPanelLayoutTypeItem.create=function(t,e){var i=new BX.CrmWidgetPanelLayoutTypeItem;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetPanelConfiguratorTab==="undefined"){BX.CrmWidgetPanelConfiguratorTab=function(){this._id="";this._settings=null;this._title="";this._configurator=null;this._isActive=false;this._container=null;this._element=null;this._clickHandler=BX.delegate(this.onClick,this);this._selectionNotifier=null;this._hasLayout=false};BX.CrmWidgetPanelConfiguratorTab.prototype={initialize:function(t,e){this._id=BX.type.isNotEmptyString(t)?t:"";this._settings=e?e:{};this._title=this.getSetting("title");if(this._title===""){this._title=this._id}this._configurator=this.getSetting("configurator");if(!this._configurator){throw"CrmWidgetPanelConfiguratorTab: The 'configurator' parameter is not found."}this._container=this.getSetting("container");if(!this._container){throw"CrmWidgetPanelConfiguratorTab: The 'container' parameter is not found."}this._isActive=this.getSetting("isActive",false);this._selectionNotifier=BX.CrmNotifier.create(this)},getId:function(){return this._id},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},addSelectionListener:function(t){this._selectionNotifier.addListener(t)},removeSelectionListener:function(t){this._selectionNotifier.removeListener(t)},layout:function(){if(this._hasLayout){return}this._element=BX.create("A",{attrs:{className:"sidebar-tab"},props:{href:"#"},text:this._title});this._container.appendChild(this._element);BX.bind(this._element,"click",this._clickHandler);var t=this.getSetting("className","");if(t!==""){BX.addClass(this._element,t)}this._hasLayout=true},cleanLayout:function(){if(!this._hasLayout){return}BX.unbind(this._element,"click",this._clickHandler);BX.cleanNode(this._element,true);this._element=null;this._hasLayout=false},onClick:function(t){if(this._isActive){this._selectionNotifier.notify()}return BX.PreventDefault(t)}};BX.CrmWidgetPanelConfiguratorTab.create=function(t,e){var i=new BX.CrmWidgetPanelConfiguratorTab;i.initialize(t,e);return i}}if(typeof BX.CrmWidgetDataGroup==="undefined"){BX.CrmWidgetDataGroup=function(){this._settings={}};BX.CrmWidgetDataGroup.prototype={initialize:function(t){this._settings=t?t:{};this.doInitialize()},doInitialize:function(){},getSetting:function(t,e){return this._settings.hasOwnProperty(t)?this._settings[t]:e},getDefault:function(){return""},prepareListItems:function(){return[]}}}if(typeof BX.CrmGraphWidgetDataGroup==="undefined"){BX.CrmGraphWidgetDataGroup=function(){BX.CrmGraphWidgetDataGroup.superclass.constructor.apply(this)};BX.CrmGraphWidgetDataGroup.undefined="";BX.CrmGraphWidgetDataGroup.date="DATE";BX.CrmGraphWidgetDataGroup.user="USER";BX.extend(BX.CrmGraphWidgetDataGroup,BX.CrmWidgetDataGroup);BX.CrmGraphWidgetDataGroup.prototype.getDefault=function(){return BX.CrmGraphWidgetDataGroup.date};BX.CrmGraphWidgetDataGroup.prototype.prepareListItems=function(t){t=!!t;var e=[];var i=BX.CrmGraphWidgetDataGroup.descriptions;for(var n in i){if(!i.hasOwnProperty(n)){continue}if(n!==BX.CrmGraphWidgetDataGroup.undefined||t){e.push({value:n,text:i[n]})}}return e};if(typeof BX.CrmGraphWidgetDataGroup.descriptions==="undefined"){BX.CrmGraphWidgetDataGroup.descriptions={}}BX.CrmGraphWidgetDataGroup.create=function(){var t=new BX.CrmGraphWidgetDataGroup;t.initialize();return t}}if(typeof BX.CrmPieWidgetDataGroup==="undefined"){BX.CrmPieWidgetDataGroup=function(){BX.CrmPieWidgetDataGroup.superclass.constructor.apply(this);this._entityTypeName=""};BX.CrmPieWidgetDataGroup.undefined="";BX.extend(BX.CrmPieWidgetDataGroup,BX.CrmWidgetDataGroup);BX.CrmPieWidgetDataGroup.prototype.doInitialize=function(){this._entityTypeName=this.getSetting("entityTypeName","");if(this._entityTypeName===""){throw"BX.CrmPieWidgetDataGroup: Could not find 'entityTypeName' parameter."}};BX.CrmPieWidgetDataGroup.prototype.getDefault=function(){return BX.CrmPieWidgetDataGroup.undefined};BX.CrmPieWidgetDataGroup.prototype.prepareListItems=function(){var t=[];var e=typeof BX.CrmPieWidgetDataGroup.descriptions[this._entityTypeName]!=="undefined"?BX.CrmPieWidgetDataGroup.descriptions[this._entityTypeName]:{};for(var i in e){if(!e.hasOwnProperty(i)){continue}t.push({value:i,text:e[i]})}return t};if(typeof BX.CrmPieWidgetDataGroup.descriptions==="undefined"){BX.CrmPieWidgetDataGroup.descriptions={}}BX.CrmPieWidgetDataGroup.create=function(){var t=new BX.CrmPieWidgetDataGroup;t.initialize();return t}}
//# sourceMappingURL=script.map.js
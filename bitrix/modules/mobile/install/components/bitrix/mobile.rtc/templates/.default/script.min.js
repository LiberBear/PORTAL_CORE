if(typeof getToken=="undefined"){var createLink=function(e){var t=BX.message("MobileSiteDir")?BX.message("MobileSiteDir"):"/";var n=false;var a=false;var o={};var i=[];if(e.substr(0,10)=="BLOG|POST|"||e.substr(0,13)=="BLOG|COMMENT|"||e.substr(0,18)=="BLOG|POST_MENTION|"||e.substr(0,21)=="BLOG|COMMENT_MENTION|"||e.substr(0,11)=="BLOG|SHARE|"||e.substr(0,17)=="BLOG|SHARE2USERS|"){i=e.split("|");n=t+"mobile/log/?ACTION=CONVERT&ENTITY_TYPE_ID=BLOG_POST&ENTITY_ID="+i[2]}if(e.substr(0,11)=="TASKS|TASK|"||e.substr(0,14)=="TASKS|COMMENT|"){i=e.split("|");n=t+"mobile/tasks/snmrouter/?routePage=view&TASK_ID="+i[2]}if(n){n={LINK:n,UNIQUE:a,DATA:o}}return n};BX.addCustomEvent("onPullExtendWatch",function(e){BX.PULL.extendWatch(e.id,e.force)});BX.addCustomEvent("onPullClearWatch",function(e){BX.PULL.extendWatch(e.id)});BX.addCustomEvent("thisPageWillDie",function(e){BX.PULL.clearWatch(e.page_id)});BX.addCustomEvent("onPullEvent",function(e,t,n){BXMobileApp.onCustomEvent("onPull-"+e,{command:t,params:n});BXMobileApp.onCustomEvent("onPull",{module_id:e,command:t,params:n})});BX.addCustomEvent("onPullOnlineEvent",function(e,t){BXMobileApp.onCustomEvent("onPullOnline",{command:e,params:t})});BX.PULL.authTimeout=null;BX.addCustomEvent("onPullError",function(e){if(e=="AUTHORIZE_ERROR"){clearTimeout(BX.PULL.authTimeout);BX.PULL.authTimeout=setTimeout(function(){app.BasicAuth({success:function(){BX.PULL.setPrivateVar("_pullTryConnect",true);BX.PULL.updateState("13",true)}})},500)}});BX.addCustomEvent("onCallInvite",function(e){if(e.userId)mwebrtc.callInvite(e.userId,e.video!="NO")});BX.addCustomEvent("onOpenPush",function(e){var t=BXMobileApp.PushManager.prepareParams(e);if(BX.util.in_array(t.ACTION,["post","tasks","comment","mention","share","share2users"])){var n=createLink(t.TAG);if(typeof n.LINK!="undefined"&&n.LINK.length>0){BXMobileApp.PageManager.loadPageUnique({url:n.LINK,unique:n.UNIQUE,data:n.DATA,bx24ModernStyle:true})}}});BX.ready(function(){BXIM=new BX.ImMobile({mobileAction:"INIT",userId:BX.message("USER_ID")})});var getToken=function(e){var t=window.platform=="ios"?"APPLE":"GOOGLE"+(app.enableInVersion(14)?"/REV2":"");var n={iOSUseVoipService:true,callback:function(n){var a=null;if(typeof n=="object"){if(n.voipToken){a=n.voipToken;t="APPLE/VOIP"}else if(n.token){a=n.token}}else{a=n}var o={url:app.dataBrigePath,method:"POST",tokenSaveRequest:true,data:{mobile_action:"save_device_token",device_name:typeof device.name=="undefined"?device.model:device.name,uuid:device.uuid,device_token:a,device_type:t,sessid:BX.bitrix_sessid()}};if(e){o.repeatble=true;var i=function(e,t,n){BX.removeCustomEvent("onAjaxFailure",i);if(n.tokenSaveRequest&&t==401&&n.repeatble){app.BasicAuth({success:function(){getToken(false)}})}};BX.addCustomEvent("onAjaxFailure",i)}BX.ajax(o)}};app.exec("getToken",n)};getToken(true)}
//# sourceMappingURL=script.map.js
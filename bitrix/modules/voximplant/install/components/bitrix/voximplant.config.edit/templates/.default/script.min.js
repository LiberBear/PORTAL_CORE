(function(e){if(!!e.BX.VoxImplantConfigEdit)return;var t=function(e,t){this.p=!!e?e:{};if(!!e["SELECTED"]){var i={},n,o;for(n in e["SELECTED"]){if(e["SELECTED"].hasOwnProperty(n)&&typeof e["SELECTED"][n]=="object"){for(o in e["SELECTED"][n]){if(e["SELECTED"][n].hasOwnProperty(o)){if(n=="USERS")i["U"+e["SELECTED"][n][o]]="users";else if(n=="SG")i["SG"+e["SELECTED"][n][o]]="sonetgroups";else if(n=="DR")i["DR"+e["SELECTED"][n][o]]="department"}}}}this.p["SELECTED"]=i}this.nodes={};var s=function(e,t){var i={},n,o,a;if(t[e]){for(a in t[e]){if(t[e].hasOwnProperty(a)){n=t[e][a];o=[];if(t[n]&&t[n].length>0)o=s(n,t);i[n]={id:n,type:"category",items:o}}}}return i},a=function(e){var t={},i;for(var n in e){if(e.hasOwnProperty(n)){i=e[n]["parent"];if(!t[i])t[i]=[];t[i][t[i].length]=n}}return s("DR0",t)};if(true||t=="users"){this.params={name:null,searchInput:null,extranetUser:this.p["EXTRANET_USER"]=="Y",bindMainPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},departmentSelectDisable:true,callback:{select:BX.delegate(this.select,this),unSelect:BX.delegate(this.unSelect,this),openDialog:BX.delegate(this.openDialog,this),closeDialog:BX.delegate(this.closeDialog,this),openSearch:BX.delegate(this.openDialog,this),closeSearch:BX.delegate(this.closeSearch,this)},items:{users:!!this.p["USERS"]?this.p["USERS"]:{},groups:{},sonetgroups:{},department:!!this.p["DEPARTMENT"]?this.p["DEPARTMENT"]:{},departmentRelation:!!this.p["DEPARTMENT"]?a(this.p["DEPARTMENT"]):{},contacts:{},companies:{},leads:{},deals:{}},itemsLast:{users:!!this.p["LAST"]&&!!this.p["LAST"]["USERS"]?this.p["LAST"]["USERS"]:{},sonetgroups:{},department:{},groups:{},contacts:{},companies:{},leads:{},deals:{},crm:[]},itemsSelected:!!this.p["SELECTED"]?BX.clone(this.p["SELECTED"]):{},isCrmFeed:false,destSort:!!this.p["DEST_SORT"]?BX.clone(this.p["DEST_SORT"]):{}}}},i=null;t.prototype={setInput:function(e,t){e=BX(e);if(!!e&&!e.hasAttribute("bx-destination-id")){var i="destination"+(""+(new Date).getTime()).substr(6),o;e.setAttribute("bx-destination-id",i);o=new n(i,e,t);this.nodes[i]=e;BX.defer_proxy(function(){this.params.name=o.id;this.params.searchInput=o.nodes.input;this.params.bindMainPopup.node=o.nodes.container;this.params.bindSearchPopup.node=o.nodes.container;BX.SocNetLogDestination.init(this.params)},this)()}},select:function(t,i,n,o,s){var a=i,l="S";if(i=="groups"){a="all-users"}else if(BX.util.in_array(i,["contacts","companies","leads","deals"])){a="crm"}if(i=="sonetgroups"){l="SG"}else if(i=="groups"){l="UA"}else if(i=="users"){l="U"}else if(i=="department"){l="DR"}else if(i=="contacts"){l="CRMCONTACT"}else if(i=="companies"){l="CRMCOMPANY"}else if(i=="leads"){l="CRMLEAD"}else if(i=="deals"){l="CRMDEAL"}var d=o?" bx-destination-undelete":"";d+=i=="sonetgroups"&&typeof e["arExtranetGroupID"]!="undefined"&&BX.util.in_array(t.entityId,e["arExtranetGroupID"])?" bx-destination-extranet":"";var p=BX.create("span",{attrs:{"data-id":t.id},props:{className:"bx-destination bx-destination-"+a+d},children:[BX.create("span",{props:{className:"bx-destination-text"},html:t.name})]});if(!o){p.appendChild(BX.create("span",{props:{className:"bx-destination-del-but"},events:{click:function(e){BX.SocNetLogDestination.deleteItem(t.id,i,s);BX.PreventDefault(e)},mouseover:function(){BX.addClass(this.parentNode,"bx-destination-hover")},mouseout:function(){BX.removeClass(this.parentNode,"bx-destination-hover")}}}))}BX.onCustomEvent(this.nodes[s],"select",[t,p,l])},unSelect:function(e,t,i,n){BX.onCustomEvent(this.nodes[n],"unSelect",[e])},openDialog:function(e){BX.onCustomEvent(this.nodes[e],"openDialog",[])},closeDialog:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeDialog",[]);this.disableBackspace()}},closeSearch:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeSearch",[]);this.disableBackspace()}},disableBackspace:function(){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!==null)BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(e,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}return true});setTimeout(function(){BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)}};var n=function(e,t,i){this.node=t;this.id=e;this.inputName=i;this.node.appendChild(BX.create("SPAN",{props:{className:"bx-destination-wrap"},html:['<span id="',this.id,'-container"><span class="bx-destination-wrap-item"></span></span>','<span class="bx-destination-input-box" id="',this.id,'-input-box">','<input type="text" value="" class="bx-destination-input" id="',this.id,'-input">',"</span>",'<a href="#" class="bx-destination-add" id="',this.id,'-add-button"></a>'].join("")}));BX.defer_proxy(this.bind,this)()};n.prototype={bind:function(){this.nodes={inputBox:BX(this.id+"-input-box"),input:BX(this.id+"-input"),container:BX(this.id+"-container"),button:BX(this.id+"-add-button")};BX.bind(this.nodes.input,"keyup",BX.proxy(this.search,this));BX.bind(this.nodes.input,"keydown",BX.proxy(this.searchBefore,this));BX.bind(this.nodes.button,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));BX.bind(this.nodes.container,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));this.onChangeDestination();BX.addCustomEvent(this.node,"select",BX.proxy(this.select,this));BX.addCustomEvent(this.node,"unSelect",BX.proxy(this.unSelect,this));BX.addCustomEvent(this.node,"delete",BX.proxy(this.delete,this));BX.addCustomEvent(this.node,"openDialog",BX.proxy(this.openDialog,this));BX.addCustomEvent(this.node,"closeDialog",BX.proxy(this.closeDialog,this));BX.addCustomEvent(this.node,"closeSearch",BX.proxy(this.closeSearch,this))},select:function(e,t,i){if(!BX.findChild(this.nodes.container,{attr:{"data-id":e.id}},false,false)){t.appendChild(BX.create("INPUT",{props:{type:"hidden",name:this.inputName+"["+i+"][]",value:e.id}}));this.nodes.container.appendChild(t)}this.onChangeDestination()},unSelect:function(e){var t=BX.findChildren(this.nodes.container,{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var i=0;i<t.length;i++)BX.remove(t[i])}this.onChangeDestination()},onChangeDestination:function(){this.nodes.input.innerHTML="";this.nodes.button.innerHTML=BX.SocNetLogDestination.getSelectedCount(this.id)<=0?BX.message("LM_ADD1"):BX.message("LM_ADD2")},openDialog:function(){BX.style(this.nodes.inputBox,"display","inline-block");BX.style(this.nodes.button,"display","none");BX.focus(this.nodes.input)},closeDialog:function(){if(this.nodes.input.value.length<=0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},closeSearch:function(){if(this.nodes.input.value.length>0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},searchBefore:function(e){if(e.keyCode==8&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(this.id)}return true},search:function(e){if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(this.id);return true}if(e.keyCode==27){this.nodes.input.value="";BX.style(this.nodes.button,"display","inline")}else{BX.SocNetLogDestination.search(this.nodes.input.value,true,this.id)}if(!BX.SocNetLogDestination.isOpenDialog()&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.openDialog(this.id)}else if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return true}};e.BX.VoxImplantConfigEdit={popupTooltip:{},initDestination:function(e,n,o){if(i===null)i=new t(o);i.setInput(BX(e),n)},loadMelody:function(t,i){if(typeof i!=="object")return;var n=i.INPUT_NAME||"";var o=i.DEFAULT_MELODY||"";BX.bind(BX("voximplantform").elements["MELODY_LANG"],"change",function(){if(!(!!BX("voximplantform").elements[n]&&!!BX("voximplantform").elements[n]))e.jwplayer(t+"player_div").load([{file:o.replace("#LANG_ID#",this.value)}])});BX(t+"span").appendChild(BX("file_input_"+t));BX.bind(BX(t+"default"),"click",function(){e["FILE_INPUT_"+t]._deleteFile(BX("voximplantform").elements[n])});BX.addCustomEvent(e["FILE_INPUT_"+t],"onSubmit",function(){BX(t+"span").appendChild(BX.create("SPAN",{attrs:{id:t+"waiter"},props:{className:"webform-field-upload-list"},html:"<i></i>"}))});BX.addCustomEvent(e["FILE_INPUT_"+t],"onFileUploaderChange",function(){e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDeleteFile",function(i){BX.hide(BX(t+"default"));BX(t+"notice").innerHTML=BX.message("VI_CONFIG_EDIT_DOWNLOAD_TUNE_TIP");e.jwplayer(t+"player_div").load([{file:o.replace("#LANG_ID#",BX("voximplantform").elements["MELODY_LANG"].value)}]);e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDone",function(i,n,o){BX.remove(BX(t+"waiter"));if(!!i&&i.length>0){var s=BX(t+"notice");if(o===false&&!!i[0]){if(n!="init"){s.innerHTML=BX.message("VI_CONFIG_EDIT_UPLOAD_SUCCESS");if(!!e["jwplayer"]){e.jwplayer(t+"player_div").load([{file:i[0]["fileURL"]}])}BX(t+"default").style.display=""}}else if(!!i[0]&&i[0]["error"]){s.innerHTML=i[0]["error"]}}})},showTooltip:function(e,t,i){if(this.popupTooltip[e])this.popupTooltip[e].close();this.popupTooltip[e]=new BX.PopupWindow("bx-voximplant-tooltip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},zIndex:200,events:{onPopupClose:function(){this.destroy()}},content:BX.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:i})});this.popupTooltip[e].setAngle({offset:13,position:"bottom"});this.popupTooltip[e].show();return true},hideTooltip:function(e){this.popupTooltip[e].close();this.popupTooltip[e]=null}};BX.ready(function(){var e=BX.findChildrenByClassName(BX("tel-set-main-wrap"),"tel-context-help");for(var t=0;t<e.length;t++){e[t].setAttribute("data-id",t);BX.bind(e[t],"mouseover",function(){var e=this.getAttribute("data-id");var t=this.getAttribute("data-text");BX.VoxImplantConfigEdit.showTooltip(e,this,t)});BX.bind(e[t],"mouseout",function(){var e=this.getAttribute("data-id");BX.VoxImplantConfigEdit.hideTooltip(e)})}})})(window);
//# sourceMappingURL=script.map.js
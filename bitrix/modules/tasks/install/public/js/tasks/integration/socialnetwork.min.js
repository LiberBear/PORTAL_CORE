BX.namespace("BX.Tasks.Integration");(function(){BX.Tasks.Integration.Socialnetwork={};var t=false;var e=false;var i=false;BX.Tasks.Integration.Socialnetwork.NetworkSelector=BX.Tasks.Util.Widget.extend({sys:{code:"network-selector"},options:{mode:"user",query:false,useSearch:false,useAdd:false},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);this.vars.snldId=false;this.vars.intendSearch="";this.vars.last={};this.vars.intendOpen=false;this.vars.changed=false},initialize:function(){if(this.dialogInitialized()){this.fireInitEvent()}else{if(t===false){this.fetchDestinationData()}else{this.initializeDialog()}}},dialogInitialized:function(){return this.vars.snldId!==false},open:function(){if(!this.dialogInitialized()){this.vars.intendOpen=true;this.initialize()}else if(this.vars.snldId!=i){this.vars.intendOpen=false;if(i!=false){BX.SocNetLogDestination.openDialog(this.vars.snldId)}BX.SocNetLogDestination.openDialog(this.vars.snldId);i=this.vars.snldId}},close:function(){this.vars.intendOpen=false;if(this.vars.snldId==i){BX.SocNetLogDestination.closeDialog()}},addLast:function(t){this.vars.last[t]=true},deleteLast:function(t){this.vars.last[t]=false},updateLast:function(){if(!this.vars.changed){return}var t=this.vars.last;this.vars.last={};var e={};var i=this.option("mode")=="user"?"USER":"SGROUP";e[i]=[];for(var s in t){if(t[s]===true){e[i].push(s)}}if(e[i].length>0){this.getQuery().add("integration.socialnetwork.setdestinationlast",{items:e})}this.vars.changed=false},fetchDestinationData:function(){if(!e){e=true;this.getQuery().add("integration.socialnetwork.getdestinationdata",[],{code:"get_destination_data"}).execute()}},getQuery:function(){if(typeof this.instances.query=="undefined"){if(this.option("query")){this.instances.query=this.option("query")}else{this.instances.query=new BX.Tasks.Util.Query({autoExec:true})}this.instances.query.bindEvent("executed",BX.delegate(this.onQueryExecuted,this))}return this.instances.query},onQueryExecuted:function(i){e=false;if(i.success){if(typeof i.data!="undefined"&&typeof i.data["get_destination_data"]!="undefined"){if(i.data["get_destination_data"].SUCCESS){t=i.data["get_destination_data"].RESULT;this.initializeDialog()}}}},onSelectDestination:function(t){this.vars.changed=true;this.addLast(t.entityId);t.params=t.params||{};var e={extranet:t.isExtranet=="Y",email:t.isEmail=="Y"};var i=parseInt(t.entityId);this.fireEvent("item-selected",[{id:isNaN(i)?0:i,nameFormatted:t.name||"",description:t.desc||"",avatar:t.avatar||"",name:t.params.name||"",lastName:t.params.lastName||"",email:t.email||"",type:e}])},onUnSelectDestination:function(t){this.vars.changed=true;this.deleteLast(t.entityId);this.fireEvent("item-deselected",[{id:t.entityId,name:t.name}])},onOpenDialogDestination:function(t){i=t},onCloseDialogDestination:function(t){if(t==i){this.fireEvent("close");this.updateLast()}i=false},onOpenSearchDestination:function(t){i=t},onCloseSearchDestination:function(t){if(t==i){this.fireEvent("close");this.updateLast()}i=false},onOpenEmailDestination:function(t){i=t},onCloseEmailDestination:function(t){if(t==i){this.fireEvent("close");this.updateLast()}i=false},checkIsOpened:function(){return i==this.vars.snldId},deselectItem:function(t){if(this.vars.snldId!=false){var e=this.option("mode")=="user";BX.SocNetLogDestination.deleteItem((e?"U":"SG")+t,e?"users":"groups",this.vars.snldId)}},selectItem:function(){if(this.vars.snldId!=false){var t=this.option("mode")=="user";BX.SocNetLogDestination.selectItem(this.vars.snldId,null,null,(t?"U":"SG")+id,t?"users":"groups")}},initializeDialog:function(){if(this.vars.snldId==false){this.vars.snldId=BX.util.hashCode(Math.random().toString());var e=this.scope();var i="name-"+this.id();var s=this.control("search");if(s){BX.adjust(s,{attrs:{input:i,id:i}})}var n={name:this.vars.snldId,searchInput:s||null,bindMainPopup:{node:e,offsetTop:"0px",offsetLeft:"0px"},bindSearchPopup:{node:e,offsetTop:"0px",offsetLeft:"0px"},departmentSelectDisable:true,allowAddUser:this.option("useAdd"),allowAddSocNetGroup:false,sendAjaxSearch:this.option("mode")=="user",callback:{select:BX.proxy(this.onSelectDestination,this),unSelect:BX.proxy(this.onUnSelectDestination,this),openDialog:BX.proxy(this.onOpenDialogDestination,this),closeDialog:BX.proxy(this.onCloseDialogDestination,this),openSearch:BX.proxy(this.onOpenSearchDestination,this),closeSearch:BX.proxy(this.onCloseSearchDestination,this),openEmailAdd:BX.proxy(this.onOpenEmailDestination,this),closeEmailAdd:BX.proxy(this.onCloseEmailDestination,this)}};if(this.option("useSearch")){n.showSearchInput=true}if(this.option("mode")=="user"){n.items={users:t.USERS,department:t.DEPARTMENT||{},departmentRelation:t.DEPARTMENT_RELATION||{}};n.itemsLast={users:t.LAST.USERS};n.itemsSelected=t.SELECTED||{}}else if(this.option("mode")=="group"){n.items={users:{},groups:{},department:{},departmentRelation:{},sonetgroups:t.SONETGROUPS||{}};n.itemsLast={users:{},groups:{},department:{},sonetgroups:t.LAST.SONETGROUPS||{}};n.itemsSelected={}}BX.SocNetLogDestination.init(n);if(s){var a={formName:this.vars.snldId,inputName:"name-"+this.id(),sendAjax:this.option("mode")=="user"};BX.bind(s,"keyup",BX.proxy(BX.SocNetLogDestination.BXfpSearch,a));BX.bind(s,"keydown",BX.proxy(BX.SocNetLogDestination.BXfpSearchBefore,a));BX.bind(s,"click",BX.delegate(this.open,this))}}this.fireInitEvent();if(this.vars.intendOpen){this.open()}},fireInitEvent:function(){this.fireEvent("initialized")},clearDataCache:function(){t=false}}})})();
//# sourceMappingURL=socialnetwork.map.js
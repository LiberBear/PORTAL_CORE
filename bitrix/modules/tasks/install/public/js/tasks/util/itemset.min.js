BX.namespace("Tasks.Util");(function(){BX.Tasks.Util.ItemSet=BX.Tasks.Util.Widget.extend({options:{min:false,max:false,preRendered:false,autoSync:false,itemFx:"none",itemFxHoverDelete:false},sys:{code:"item-set"},methods:{construct:function(){this.callConstruct(BX.Tasks.Util.Widget);BX.mergeEx(this.vars,{items:{},order:[],checkRestrictions:true,syncLock:true,idOffset:1,readonly:false});this.bindEvents();this.load(this.option("data"),{dontRender:this.option("preRendered"),loadInitial:true})},bindEvents:function(){this.bindItemActions();this.bindFx();this.bindDelegateControl("open-form","click",this.passCtx(this.openAddForm));this.fireChangeDeferredEvent=BX.debounce(this.fireChangeDeferredEvent,5,this)},bindItemActions:function(){this.bindDelegateControl("item-delete","click",this.passCtx(this.onItemDeleteClicked))},bindFx:function(){if(this.option("itemFxHoverDelete")){this.bindDelegateControl("item-delete","mouseover",this.passCtx(this.onItemDeleteOver));this.bindDelegateControl("item-delete","mouseout",this.passCtx(this.onItemDeleteOut))}},getItemClass:function(){return BX.Tasks.Util.ItemSet.Item},createItem:function(e,t){var i=this.getItemClass();var s=false;if(t.dontRender){s="item-"+e.VALUE}else{s=this.getNodeByTemplate("item",e)[0];BX.append(s,this.control("items"))}return new i({scope:s,data:e,parent:this})},openAddForm:function(){},addItem:function(e,t){t=t||{};if(typeof t.itemFx=="undefined"){t.itemFx=true}if("extractItemValue"in this){e.VALUE=this.extractItemValue(e)}if("extractItemDisplay"in this){e.DISPLAY=this.extractItemDisplay(e)}if("prepareData"in this){e=this.prepareData(e)}else{var i=this.getItemClass();if("prepareData"in i){e=i.prepareData.apply(this,[e])}}if(this.has(e.VALUE)||t.checkRestrictions!==false&&!this.checkCanAddItems()){return false}if(typeof e.VALUE=="undefined"||typeof e.DISPLAY=="undefined"){return false}if(this.option("itemFx")!="none"){e.ITEM_SET_INVISIBLE=t.load?"":"invisible"}var s=this.createItem(e,t);if(s==null){return false}s.bindEvent("delete",BX.delegate(this.deleteItem,this));this.vars.items[s.value()]=s;this.vars.order.push(s.value());this.processItemAfterCreate(s.value(),t);if("appear"in s){s.appear(t)}if(!t.load){this.fireChangeEvent(t)}return true},hasItem:function(e){return typeof this.vars.items[e]!="undefined"},getItem:function(e){var t=this.vars.items[e];if(typeof t=="undefined"){return null}return t},getItemFirst:function(){if(this.vars.order.length==0){return null}var e=this.vars.order[0];return this.getItem(e)},getItemLast:function(){if(this.vars.order.length==0){return null}var e=this.vars.order[this.vars.order.length-1];return this.getItem(e)},itemCount:function(){return this.vars.order.length},onItemDestroy:function(){},deleteItem:function(e,t){t=t||{};if(typeof t.itemFx=="undefined"){t.itemFx=true}if(t.checkRestrictions!==false&&!this.checkCanDeleteItems()){return false}var i=false;if(typeof e=="object"){i=e;e=i.value()}else{i=this.vars.items[e]}if(typeof i!="undefined"){this.vars.items[e]=null;delete this.vars.items[e];for(var s in this.vars.order){if(this.vars.order[s]==e){this.vars.order.splice(s,1);break}}var n=this;var r=function(){var e=this.scope();var t=this.value();this.destroy();BX.remove(e);n.onItemDestroy(t)};if("disappear"in i&&t.itemFx){i.disappear(r,t)}else{r.call(i)}this.fireChangeEvent(t);this.fireEvent("item-delete",[e]);return true}return false},replaceItem:function(e,t,i){var s={itemFx:false};BX.merge(s,i||{});s.checkRestrictions=false;if(this.deleteItem(e,s)){this.addItem(t,s)}},updateItem:function(e,t){},load:function(e,t){if(BX.type.isPlainObject(e)||BX.type.isArray(e)){e=BX.clone(e);t=BX.clone(t)||{};t.load=true;this.vars.syncLock=true;var i=0;for(var s in e){if(BX.type.isPlainObject(e[s])){if(this.addItem(e[s],t)){i++}}}if(i>0){this.fireChangeEvent(t)}this.vars.syncLock=false}},processItemAfterCreate:function(){},redraw:function(){var e=BX.create("div");for(var t in this.vars.order){var i=this.vars.order[t];BX.append(this.vars.items[i].scope(),e)}this.moveNodePool(e,this.control("items"));this.updateInstant()},checkCanAddItems:function(){var e=this.option("max");if(e===false){return true}return this.vars.order.length<parseInt(e)},checkCanDeleteItems:function(){var e=this.option("min");if(this.vars.order.length==0||e!==false&&this.vars.order.length<=parseInt(e)){return false}return true},updateDelayed:function(){},updateInstant:function(e){this.setCSSFlagEmpty();this.setCSSFlagLimits()},setCSSFlagLimits:function(){this.changeCSSFlag(this.getFullBxId("min"),!this.checkCanDeleteItems());this.changeCSSFlag(this.getFullBxId("max"),!this.checkCanAddItems())},setCSSFlagEmpty:function(){var e=this.getFullBxId("empty");this.dropCSSFlags(e+"-*");this.setCSSFlag(e+"-"+(this.vars.order.length>0?"false":"true"))},moveNodePool:function(e,t){while(e.childNodes.length>0){BX.append(e.childNodes[0],t)}},fireChangeEvent:function(e){this.fireEvent("change",[this.vars.order,e]);this.fireChangeDeferredEvent(e);this.updateInstant()},fireChangeDeferredEvent:function(e){this.fireEvent("change-deferred",[this.vars.order,e])},isEnter:function(e){e=e||window.event;return e.keyCode==13},doOnItem:function(e,t){if(this.vars.readonly){return false}var i=BX.data(e,"item-value");if(!i){var s=this.controlP("item",e,this.scope());if(s){i=BX.data(s,"item-value")}}if(typeof i!="undefined"&&i!==null){BX.data(e,"item-value",i);var n=this.vars.items[i];if(typeof n!="undefined"){t.apply(this,[this.vars.items[i]])}return i}return false},onItemDeleteClicked:function(e){this.doOnItem(e,this.deleteItem)},onItemDeleteOver:function(e){this.doOnItem(e,function(e){BX.addClass(e.scope(),"hover-delete")})},onItemDeleteOut:function(e){this.doOnItem(e,function(e){BX.removeClass(e.scope(),"hover-delete")})},getQuery:function(){if(!this.instances.query){this.instances.query=new BX.Tasks.Util.Query({autoExec:true})}return this.instances.query},checkCanSync:function(){return this.option("autoSync")&&!this.vars.syncLock},syncAllIfCan:function(){if(this.checkCanSync()){this.syncAll()}},syncAll:function(e){},extractItemValue:function(e){return e.ID},readonly:function(e){if(typeof e=="undefined"){return this.vars.readonly}else{e=!!e;this.changeCSSFlag("readonly",e);this.vars.readonly=e}},value:function(){return this.vars.order},first:function(){return this.getItemFirst()},last:function(){return this.getItemLast()},has:function(e){return this.hasItem(e)},get:function(e){return this.getItem(e)},each:function(e){if(!BX.type.isFunction(e)){return}for(var t=0;t<this.vars.order.length;t++){e.apply(this,[this.vars.items[this.vars.order[t]]])}},count:function(){return this.vars.order.length}}});BX.Tasks.Util.ItemSet.Item=BX.Tasks.Util.Widget.extend({sys:{code:"item-set-item"},methods:{value:function(){return this.option("data").VALUE},display:function(){return this.option("data").DISPLAY},data:function(){return this.option("data")},appear:function(e){if(!e.dontRender&&!e.load){if(this.optionP("itemFx")!="none"){BX.Tasks.Util.fadeToggleByClass(this.scope(),200)}}},disappear:function(e,t){var i=this.optionP("itemFx");if(i!="horizontal"&&i!="vertical"){e.apply(this)}else{BX.Tasks.Util[i=="horizontal"?"fadeSlideHToggleByClass":"fadeSlideToggleByClass"](this.scope(),200,BX.delegate(e,this))}}}});BX.Tasks.Util.ItemSet.Item.prepareData=function(e){return e}})();
//# sourceMappingURL=itemset.map.js